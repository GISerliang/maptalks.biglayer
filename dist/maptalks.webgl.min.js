/*!
 * maptalks.webgl v0.3.0
 * LICENSE : MIT
 * (c) 2016-2017 maptalks.org
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(t,e){"use strict";function r(t,e){return e={exports:{}},t(e,e.exports),e.exports}function n(t,e){for(var r=Object.getOwnPropertyNames(e),n=0;n<r.length;n++){var a=r[n],i=Object.getOwnPropertyDescriptor(e,a);i&&i.configurable&&void 0===t[a]&&Object.defineProperty(t,a,i)}return t}function a(t){return t.getMaxNativeZoom()/2}function i(t,e){this.x=t,this.y=e}function o(t,e,r){r=r||2;var n=e&&e.length,a=n?e[0]*r:t.length,i=s(t,0,a,r,!0),o=[];if(!i)return o;var l,h,f,c,v,d,x;if(n&&(i=p(t,e,i,r)),t.length>80*r){l=f=t[0],h=c=t[1];for(var y=r;y<a;y+=r)v=t[y],d=t[y+1],v<l&&(l=v),d<h&&(h=d),v>f&&(f=v),d>c&&(c=d);x=Math.max(f-l,c-h)}return u(i,o,r,l,h,x),o}function s(t,e,r,n,a){var i,o;if(a===T(t,e,r,n)>0)for(i=e;i<r;i+=n)o=P(i,t[i],t[i+1],o);else for(i=r-n;i>=e;i-=n)o=P(i,t[i],t[i+1],o);return o&&F(o,o.next)&&(z(o),o=o.next),o}function l(t,e){if(!t)return t;e||(e=t);var r,n=t;do if(r=!1,n.steiner||!F(n,n.next)&&0!==I(n.prev,n,n.next))n=n.next;else{if(z(n),n=e=n.prev,n===n.next)return null;r=!0}while(r||n!==e);return e}function u(t,e,r,n,a,i,o){if(t){!o&&i&&M(t,n,a,i);for(var s,p,d=t;t.prev!==t.next;)if(s=t.prev,p=t.next,i?f(t,n,a,i):h(t))e.push(s.i/r),e.push(t.i/r),e.push(p.i/r),z(t),t=p.next,d=p.next;else if(t=p,t===d){o?1===o?(t=c(t,e,r),u(t,e,r,n,a,i,2)):2===o&&v(t,e,r,n,a,i):u(l(t),e,r,n,a,i,1);break}}}function h(t){var e=t.prev,r=t,n=t.next;if(I(e,r,n)>=0)return!1;for(var a=t.next.next;a!==t.prev;){if(S(e.x,e.y,r.x,r.y,n.x,n.y,a.x,a.y)&&I(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function f(t,e,r,n){var a=t.prev,i=t,o=t.next;if(I(a,i,o)>=0)return!1;for(var s=a.x<i.x?a.x<o.x?a.x:o.x:i.x<o.x?i.x:o.x,l=a.y<i.y?a.y<o.y?a.y:o.y:i.y<o.y?i.y:o.y,u=a.x>i.x?a.x>o.x?a.x:o.x:i.x>o.x?i.x:o.x,h=a.y>i.y?a.y>o.y?a.y:o.y:i.y>o.y?i.y:o.y,f=m(s,l,e,r,n),c=m(u,h,e,r,n),v=t.nextZ;v&&v.z<=c;){if(v!==t.prev&&v!==t.next&&S(a.x,a.y,i.x,i.y,o.x,o.y,v.x,v.y)&&I(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(v=t.prevZ;v&&v.z>=f;){if(v!==t.prev&&v!==t.next&&S(a.x,a.y,i.x,i.y,o.x,o.y,v.x,v.y)&&I(v.prev,v,v.next)>=0)return!1;v=v.prevZ}return!0}function c(t,e,r){var n=t;do{var a=n.prev,i=n.next.next;!F(a,i)&&D(a,n,n.next,i)&&w(a,i)&&w(i,a)&&(e.push(a.i/r),e.push(n.i/r),e.push(i.i/r),z(n),z(n.next),n=t=i),n=n.next}while(n!==t);return n}function v(t,e,r,n,a,i){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&b(o,s)){var h=R(o,s);return o=l(o,o.next),h=l(h,h.next),u(o,e,r,n,a,i),void u(h,e,r,n,a,i)}s=s.next}o=o.next}while(o!==t)}function p(t,e,r,n){var a,i,o,u,h,f=[];for(a=0,i=e.length;a<i;a++)o=e[a]*n,u=a<i-1?e[a+1]*n:t.length,h=s(t,o,u,n,!1),h===h.next&&(h.steiner=!0),f.push(_(h));for(f.sort(d),a=0;a<f.length;a++)x(f[a],r),r=l(r,r.next);return r}function d(t,e){return t.x-e.x}function x(t,e){if(e=y(t,e)){var r=R(e,t);l(r,r.next)}}function y(t,e){var r,n=e,a=t.x,i=t.y,o=-(1/0);do{if(i<=n.y&&i>=n.next.y){var s=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=a&&s>o){if(o=s,s===a){if(i===n.y)return n;if(i===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(a===o)return r.prev;var l,u=r,h=r.x,f=r.y,c=1/0;for(n=r.next;n!==u;)a>=n.x&&n.x>=h&&S(i<f?a:o,i,h,f,i<f?o:a,i,n.x,n.y)&&(l=Math.abs(i-n.y)/(a-n.x),(l<c||l===c&&n.x>r.x)&&w(n,t)&&(r=n,c=l)),n=n.next;return r}function M(t,e,r,n){var a=t;do null===a.z&&(a.z=m(a.x,a.y,e,r,n)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next;while(a!==t);a.prevZ.nextZ=null,a.prevZ=null,g(a)}function g(t){var e,r,n,a,i,o,s,l,u=1;do{for(r=t,t=null,i=null,o=0;r;){for(o++,n=r,s=0,e=0;e<u&&(s++,n=n.nextZ,n);e++);for(l=u;s>0||l>0&&n;)0===s?(a=n,n=n.nextZ,l--):0!==l&&n?r.z<=n.z?(a=r,r=r.nextZ,s--):(a=n,n=n.nextZ,l--):(a=r,r=r.nextZ,s--),i?i.nextZ=a:t=a,a.prevZ=i,i=a;r=n}i.nextZ=null,u*=2}while(o>1);return t}function m(t,e,r,n,a){return t=32767*(t-r)/a,e=32767*(e-n)/a,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function _(t){var e=t,r=t;do e.x<r.x&&(r=e),e=e.next;while(e!==t);return r}function S(t,e,r,n,a,i,o,s){return(a-o)*(e-s)-(t-o)*(i-s)>=0&&(t-o)*(n-s)-(r-o)*(e-s)>=0&&(r-o)*(i-s)-(a-o)*(n-s)>=0}function b(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!A(t,e)&&w(t,e)&&w(e,t)&&E(t,e)}function I(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function F(t,e){return t.x===e.x&&t.y===e.y}function D(t,e,r,n){return!!(F(t,e)&&F(r,n)||F(t,n)&&F(r,e))||I(t,e,r)>0!=I(t,e,n)>0&&I(r,n,t)>0!=I(r,n,e)>0}function A(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&D(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function w(t,e){return I(t.prev,t,t.next)<0?I(t,e,t.next)>=0&&I(t,t.prev,e)>=0:I(t,e,t.prev)<0||I(t,t.next,e)<0}function E(t,e){var r=t,n=!1,a=(t.x+e.x)/2,i=(t.y+e.y)/2;do r.y>i!=r.next.y>i&&a<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==t);return n}function R(t,e){var r=new C(t.i,t.x,t.y),n=new C(e.i,e.x,e.y),a=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=a,a.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function P(t,e,r,n){var a=new C(t,e,r);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function z(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function C(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function T(t,e,r,n){for(var a=0,i=e,o=r-n;i<r;i+=n)a+=(t[o]-t[i])*(t[i+1]+t[o+1]),o=i;return a}function B(t,e,r,n,a,i){if(!(a-n<=r)){var o=Math.floor((n+a)/2);L(t,e,o,n,a,i%2),B(t,e,r,n,o-1,i+1),B(t,e,r,o+1,a,i+1)}}function L(t,e,r,n,a,i){for(;a>n;){if(a-n>600){var o=a-n+1,s=r-n+1,l=Math.log(o),u=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*u*(o-u)/o)*(s-o/2<0?-1:1),f=Math.max(n,Math.floor(r-s*u/o+h)),c=Math.min(a,Math.floor(r+(o-s)*u/o+h));L(t,e,r,f,c,i)}var v=e[2*r+i],p=n,d=a;for(k(t,e,n,r),e[2*a+i]>v&&k(t,e,n,a);p<d;){for(k(t,e,p,d),p++,d--;e[2*p+i]<v;)p++;for(;e[2*d+i]>v;)d--}e[2*n+i]===v?k(t,e,n,d):(d++,k(t,e,d,a)),d<=r&&(n=d+1),r<=d&&(a=d-1)}}function k(t,e,r,n){N(t,r,n),N(e,2*r,2*n),N(e,2*r+1,2*n+1)}function N(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function O(t,e,r,n,a,i,o){for(var s,l,u=[0,t.length-1,0],h=[];u.length;){var f=u.pop(),c=u.pop(),v=u.pop();if(c-v<=o)for(var p=v;p<=c;p++)s=e[2*p],l=e[2*p+1],s>=r&&s<=a&&l>=n&&l<=i&&h.push(t[p]);else{var d=Math.floor((v+c)/2);s=e[2*d],l=e[2*d+1],s>=r&&s<=a&&l>=n&&l<=i&&h.push(t[d]);var x=(f+1)%2;(0===f?r<=s:n<=l)&&(u.push(v),u.push(d-1),u.push(x)),(0===f?a>=s:i>=l)&&(u.push(d+1),u.push(c),u.push(x))}}return h}function U(t,e,r,n,a,i){for(var o=[0,t.length-1,0],s=[],l=a*a;o.length;){var u=o.pop(),h=o.pop(),f=o.pop();if(h-f<=i)for(var c=f;c<=h;c++)Y(e[2*c],e[2*c+1],r,n)<=l&&s.push(t[c]);else{var v=Math.floor((f+h)/2),p=e[2*v],d=e[2*v+1];Y(p,d,r,n)<=l&&s.push(t[v]);var x=(u+1)%2;(0===u?r-a<=p:n-a<=d)&&(o.push(f),o.push(v-1),o.push(x)),(0===u?r+a>=p:n+a>=d)&&(o.push(v+1),o.push(h),o.push(x))}}return s}function Y(t,e,r,n){var a=t-r,i=e-n;return a*a+i*i}function q(t,e,r,n,a){return new V(t,e,r,n,a)}function V(t,e,r,n,a){e=e||j,r=r||Z,a=a||Array,this.nodeSize=n||64,this.points=t,this.ids=new a(t.length),this.coords=new a(2*t.length);for(var i=0;i<t.length;i++)this.ids[i]=i,this.coords[2*i]=e(t[i]),this.coords[2*i+1]=r(t[i]);xe(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function j(t){return t[0]}function Z(t){return t[1]}function W(){for(var t={},e=Fe.length,r=0;r<e;r++)t[Fe[r]]={distance:-1,parent:null};return t}function G(t){var e=W(),r=[t];for(e[t].distance=0;r.length;)for(var n=r.pop(),a=Object.keys(Ie[n]),i=a.length,o=0;o<i;o++){var s=a[o],l=e[s];l.distance===-1&&(l.distance=e[n].distance+1,l.parent=n,r.unshift(s))}return e}function X(t,e){return function(r){return e(t(r))}}function J(t,e){for(var r=[e[t].parent,t],n=Ie[e[t].parent][t],a=e[t].parent;e[a].parent;)r.unshift(e[a].parent),n=X(Ie[e[a].parent][a],n),a=e[a].parent;return n.conversion=r,n}function H(t){var e=function(e){return void 0===e||null===e?e:(arguments.length>1&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}function K(t){var e=function(e){if(void 0===e||null===e)return e;arguments.length>1&&(e=Array.prototype.slice.call(arguments));var r=t(e);if("object"===("undefined"==typeof r?"undefined":Ut(r)))for(var n=r.length,a=0;a<n;a++)r[a]=Math.round(r[a]);return r};return"conversion"in t&&(e.conversion=t.conversion),e}function Q(t){if(t){var e=/^#([a-fA-F0-9]{3})$/,r=/^#([a-fA-F0-9]{6})$/,n=/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,a=/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,i=/(\D+)/,o=[0,0,0],s=1,l=t.match(e);if(l){l=l[1];for(var u=0;u<o.length;u++)o[u]=parseInt(l[u]+l[u],16)}else if(l=t.match(r)){l=l[1];for(var u=0;u<o.length;u++)o[u]=parseInt(l.slice(2*u,2*u+2),16)}else if(l=t.match(n)){for(var u=0;u<o.length;u++)o[u]=parseInt(l[u+1]);s=parseFloat(l[4])}else if(l=t.match(a)){for(var u=0;u<o.length;u++)o[u]=Math.round(2.55*parseFloat(l[u+1]));s=parseFloat(l[4])}else if(l=t.match(i)){if("transparent"==l[1])return[0,0,0,0];if(o=ze[l[1]],!o)return}for(var u=0;u<o.length;u++)o[u]=vt(o[u],0,255);return s=s||0==s?vt(s,0,1):1,o[3]=s,o}}function $(t){if(t){var e=/^hsla?\(\s*([+-]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)/,r=t.match(e);if(r){var n=parseFloat(r[4]),a=vt(parseInt(r[1]),0,360),i=vt(parseFloat(r[2]),0,100),o=vt(parseFloat(r[3]),0,100),s=vt(isNaN(n)?1:n,0,1);return[a,i,o,s]}}}function tt(t){if(t){var e=/^hwb\(\s*([+-]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)/,r=t.match(e);if(r){var n=parseFloat(r[4]),a=vt(parseInt(r[1]),0,360),i=vt(parseFloat(r[2]),0,100),o=vt(parseFloat(r[3]),0,100),s=vt(isNaN(n)?1:n,0,1);return[a,i,o,s]}}}function et(t){var e=Q(t);return e&&e.slice(0,3)}function rt(t){var e=$(t);return e&&e.slice(0,3)}function nt(t){var e=Q(t);return e?e[3]:(e=$(t))?e[3]:(e=tt(t))?e[3]:void 0}function at(t){return"#"+pt(t[0])+pt(t[1])+pt(t[2])}function it(t,e){return e<1||t[3]&&t[3]<1?ot(t,e):"rgb("+t[0]+", "+t[1]+", "+t[2]+")"}function ot(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+e+")"}function st(t,e){if(e<1||t[3]&&t[3]<1)return lt(t,e);var r=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),a=Math.round(t[2]/255*100);return"rgb("+r+"%, "+n+"%, "+a+"%)"}function lt(t,e){var r=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),a=Math.round(t[2]/255*100);return"rgba("+r+"%, "+n+"%, "+a+"%, "+(e||t[3]||1)+")"}function ut(t,e){return e<1||t[3]&&t[3]<1?ht(t,e):"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)"}function ht(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+e+")"}function ft(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+(void 0!==e&&1!==e?", "+e:"")+")"}function ct(t){return Te[t.slice(0,3)]}function vt(t,e,r){return Math.min(Math.max(e,t),r)}function pt(t){var e=t.toString(16).toUpperCase();return e.length<2?"0"+e:e}var dt="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},xt={};xt.EPSILON=1e-6,xt.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,xt.RANDOM=Math.random,xt.ENABLE_SIMD=!1,xt.SIMD_AVAILABLE=xt.ARRAY_TYPE===Float32Array&&"SIMD"in dt,xt.USE_SIMD=xt.ENABLE_SIMD&&xt.SIMD_AVAILABLE,xt.setMatrixArrayType=function(t){xt.ARRAY_TYPE=t};var yt=Math.PI/180;xt.toRadian=function(t){return t*yt},xt.equals=function(t,e){return Math.abs(t-e)<=xt.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))};var Mt=xt,gt=Mt,mt={};mt.create=function(){var t=new gt.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mt.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},mt.clone=function(t){var e=new gt.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},mt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},mt.fromValues=function(t,e,r,n,a,i,o,s,l){var u=new gt.ARRAY_TYPE(9);return u[0]=t,u[1]=e,u[2]=r,u[3]=n,u[4]=a,u[5]=i,u[6]=o,u[7]=s,u[8]=l,u},mt.set=function(t,e,r,n,a,i,o,s,l,u){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=i,t[5]=o,t[6]=s,t[7]=l,t[8]=u,t},mt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mt.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},mt.invert=function(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],o=e[4],s=e[5],l=e[6],u=e[7],h=e[8],f=h*o-s*u,c=-h*i+s*l,v=u*i-o*l,p=r*f+n*c+a*v;return p?(p=1/p,t[0]=f*p,t[1]=(-h*n+a*u)*p,t[2]=(s*n-a*o)*p,t[3]=c*p,t[4]=(h*r-a*l)*p,t[5]=(-s*r+a*i)*p,t[6]=v*p,t[7]=(-u*r+n*l)*p,t[8]=(o*r-n*i)*p,t):null},mt.adjoint=function(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],o=e[4],s=e[5],l=e[6],u=e[7],h=e[8];return t[0]=o*h-s*u,t[1]=a*u-n*h,t[2]=n*s-a*o,t[3]=s*l-i*h,t[4]=r*h-a*l,t[5]=a*i-r*s,t[6]=i*u-o*l,t[7]=n*l-r*u,t[8]=r*o-n*i,t},mt.determinant=function(t){var e=t[0],r=t[1],n=t[2],a=t[3],i=t[4],o=t[5],s=t[6],l=t[7],u=t[8];return e*(u*i-o*l)+r*(-u*a+o*s)+n*(l*a-i*s)},mt.multiply=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=e[3],s=e[4],l=e[5],u=e[6],h=e[7],f=e[8],c=r[0],v=r[1],p=r[2],d=r[3],x=r[4],y=r[5],M=r[6],g=r[7],m=r[8];return t[0]=c*n+v*o+p*u,t[1]=c*a+v*s+p*h,t[2]=c*i+v*l+p*f,t[3]=d*n+x*o+y*u,t[4]=d*a+x*s+y*h,t[5]=d*i+x*l+y*f,t[6]=M*n+g*o+m*u,t[7]=M*a+g*s+m*h,t[8]=M*i+g*l+m*f,t},mt.mul=mt.multiply,mt.translate=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=e[3],s=e[4],l=e[5],u=e[6],h=e[7],f=e[8],c=r[0],v=r[1];return t[0]=n,t[1]=a,t[2]=i,t[3]=o,t[4]=s,t[5]=l,t[6]=c*n+v*o+u,t[7]=c*a+v*s+h,t[8]=c*i+v*l+f,t},mt.rotate=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=e[3],s=e[4],l=e[5],u=e[6],h=e[7],f=e[8],c=Math.sin(r),v=Math.cos(r);return t[0]=v*n+c*o,t[1]=v*a+c*s,t[2]=v*i+c*l,t[3]=v*o-c*n,t[4]=v*s-c*a,t[5]=v*l-c*i,t[6]=u,t[7]=h,t[8]=f,t},mt.scale=function(t,e,r){var n=r[0],a=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},mt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},mt.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mt.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},mt.fromQuat=function(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],o=r+r,s=n+n,l=a+a,u=r*o,h=n*o,f=n*s,c=a*o,v=a*s,p=a*l,d=i*o,x=i*s,y=i*l;return t[0]=1-f-p,t[3]=h-y,t[6]=c+x,t[1]=h+y,t[4]=1-u-p,t[7]=v-d,t[2]=c-x,t[5]=v+d,t[8]=1-u-f,t},mt.normalFromMat4=function(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],o=e[4],s=e[5],l=e[6],u=e[7],h=e[8],f=e[9],c=e[10],v=e[11],p=e[12],d=e[13],x=e[14],y=e[15],M=r*s-n*o,g=r*l-a*o,m=r*u-i*o,_=n*l-a*s,S=n*u-i*s,b=a*u-i*l,I=h*d-f*p,F=h*x-c*p,D=h*y-v*p,A=f*x-c*d,w=f*y-v*d,E=c*y-v*x,R=M*E-g*w+m*A+_*D-S*F+b*I;return R?(R=1/R,t[0]=(s*E-l*w+u*A)*R,t[1]=(l*D-o*E-u*F)*R,t[2]=(o*w-s*D+u*I)*R,t[3]=(a*w-n*E-i*A)*R,t[4]=(r*E-a*D+i*F)*R,t[5]=(n*D-r*w-i*I)*R,t[6]=(d*b-x*S+y*_)*R,t[7]=(x*m-p*b-y*g)*R,t[8]=(p*S-d*m+y*M)*R,t):null},mt.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},mt.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},mt.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},mt.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t},mt.sub=mt.subtract,mt.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},mt.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t},mt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},mt.equals=function(t,e){var r=t[0],n=t[1],a=t[2],i=t[3],o=t[4],s=t[5],l=t[6],u=t[7],h=t[8],f=e[0],c=e[1],v=e[2],p=e[3],d=e[4],x=e[5],y=t[6],M=e[7],g=e[8];return Math.abs(r-f)<=gt.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-c)<=gt.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-v)<=gt.EPSILON*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(i-p)<=gt.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(o-d)<=gt.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(s-x)<=gt.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(l-y)<=gt.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(u-M)<=gt.EPSILON*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(h-g)<=gt.EPSILON*Math.max(1,Math.abs(h),Math.abs(g))};var _t=mt,St=Mt,bt={scalar:{},SIMD:{}};bt.create=function(){var t=new St.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},bt.clone=function(t){var e=new St.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},bt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},bt.fromValues=function(t,e,r,n,a,i,o,s,l,u,h,f,c,v,p,d){var x=new St.ARRAY_TYPE(16);return x[0]=t,x[1]=e,x[2]=r,x[3]=n,x[4]=a,x[5]=i,x[6]=o,x[7]=s,x[8]=l,x[9]=u,x[10]=h,x[11]=f,x[12]=c,x[13]=v,x[14]=p,x[15]=d,x},bt.set=function(t,e,r,n,a,i,o,s,l,u,h,f,c,v,p,d,x){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=i,t[5]=o,t[6]=s,t[7]=l,t[8]=u,t[9]=h,t[10]=f,t[11]=c,t[12]=v,t[13]=p,t[14]=d,t[15]=x,t},bt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},bt.scalar.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],a=e[3],i=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=i,t[11]=e[14],t[12]=a,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},bt.SIMD.transpose=function(t,e){var r,n,a,i,o,s,l,u,h,f;return r=SIMD.Float32x4.load(e,0),n=SIMD.Float32x4.load(e,4),a=SIMD.Float32x4.load(e,8),i=SIMD.Float32x4.load(e,12),o=SIMD.Float32x4.shuffle(r,n,0,1,4,5),s=SIMD.Float32x4.shuffle(a,i,0,1,4,5),l=SIMD.Float32x4.shuffle(o,s,0,2,4,6),u=SIMD.Float32x4.shuffle(o,s,1,3,5,7),SIMD.Float32x4.store(t,0,l),SIMD.Float32x4.store(t,4,u),o=SIMD.Float32x4.shuffle(r,n,2,3,6,7),s=SIMD.Float32x4.shuffle(a,i,2,3,6,7),h=SIMD.Float32x4.shuffle(o,s,0,2,4,6),f=SIMD.Float32x4.shuffle(o,s,1,3,5,7),SIMD.Float32x4.store(t,8,h),SIMD.Float32x4.store(t,12,f),t},bt.transpose=St.USE_SIMD?bt.SIMD.transpose:bt.scalar.transpose,bt.scalar.invert=function(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],o=e[4],s=e[5],l=e[6],u=e[7],h=e[8],f=e[9],c=e[10],v=e[11],p=e[12],d=e[13],x=e[14],y=e[15],M=r*s-n*o,g=r*l-a*o,m=r*u-i*o,_=n*l-a*s,S=n*u-i*s,b=a*u-i*l,I=h*d-f*p,F=h*x-c*p,D=h*y-v*p,A=f*x-c*d,w=f*y-v*d,E=c*y-v*x,R=M*E-g*w+m*A+_*D-S*F+b*I;return R?(R=1/R,t[0]=(s*E-l*w+u*A)*R,t[1]=(a*w-n*E-i*A)*R,t[2]=(d*b-x*S+y*_)*R,t[3]=(c*S-f*b-v*_)*R,t[4]=(l*D-o*E-u*F)*R,t[5]=(r*E-a*D+i*F)*R,t[6]=(x*m-p*b-y*g)*R,t[7]=(h*b-c*m+v*g)*R,t[8]=(o*w-s*D+u*I)*R,t[9]=(n*D-r*w-i*I)*R,t[10]=(p*S-d*m+y*M)*R,t[11]=(f*m-h*S-v*M)*R,t[12]=(s*F-o*A-l*I)*R,t[13]=(r*A-n*F+a*I)*R,t[14]=(d*g-p*_-x*M)*R,t[15]=(h*_-f*g+c*M)*R,t):null},bt.SIMD.invert=function(t,e){var r,n,a,i,o,s,l,u,h,f,c=SIMD.Float32x4.load(e,0),v=SIMD.Float32x4.load(e,4),p=SIMD.Float32x4.load(e,8),d=SIMD.Float32x4.load(e,12);return o=SIMD.Float32x4.shuffle(c,v,0,1,4,5),n=SIMD.Float32x4.shuffle(p,d,0,1,4,5),r=SIMD.Float32x4.shuffle(o,n,0,2,4,6),n=SIMD.Float32x4.shuffle(n,o,1,3,5,7),o=SIMD.Float32x4.shuffle(c,v,2,3,6,7),i=SIMD.Float32x4.shuffle(p,d,2,3,6,7),a=SIMD.Float32x4.shuffle(o,i,0,2,4,6),i=SIMD.Float32x4.shuffle(i,o,1,3,5,7),o=SIMD.Float32x4.mul(a,i),o=SIMD.Float32x4.swizzle(o,1,0,3,2),s=SIMD.Float32x4.mul(n,o),l=SIMD.Float32x4.mul(r,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,o),s),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,o),l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),o=SIMD.Float32x4.mul(n,a),o=SIMD.Float32x4.swizzle(o,1,0,3,2),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,o),s),h=SIMD.Float32x4.mul(r,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(i,o)),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,o),h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),o=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,2,3,0,1),i),o=SIMD.Float32x4.swizzle(o,1,0,3,2),a=SIMD.Float32x4.swizzle(a,2,3,0,1),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,o),s),u=SIMD.Float32x4.mul(r,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(a,o)),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,o),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),o=SIMD.Float32x4.mul(r,n),o=SIMD.Float32x4.swizzle(o,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,o),u),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,o),h),o=SIMD.Float32x4.swizzle(o,2,3,0,1),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,o),u),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(a,o)),o=SIMD.Float32x4.mul(r,i),o=SIMD.Float32x4.swizzle(o,1,0,3,2),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(a,o)),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,o),u),o=SIMD.Float32x4.swizzle(o,2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,o),l),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(n,o)),o=SIMD.Float32x4.mul(r,a),o=SIMD.Float32x4.swizzle(o,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,o),l),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(n,o)),o=SIMD.Float32x4.swizzle(o,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(i,o)),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,o),h),f=SIMD.Float32x4.mul(r,s),f=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(f,2,3,0,1),f),f=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(f,1,0,3,2),f),o=SIMD.Float32x4.reciprocalApproximation(f),f=SIMD.Float32x4.sub(SIMD.Float32x4.add(o,o),SIMD.Float32x4.mul(f,SIMD.Float32x4.mul(o,o))),(f=SIMD.Float32x4.swizzle(f,0,0,0,0))?(SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(f,s)),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(f,l)),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(f,u)),SIMD.Float32x4.store(t,12,SIMD.Float32x4.mul(f,h)),t):null},bt.invert=St.USE_SIMD?bt.SIMD.invert:bt.scalar.invert,bt.scalar.adjoint=function(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],o=e[4],s=e[5],l=e[6],u=e[7],h=e[8],f=e[9],c=e[10],v=e[11],p=e[12],d=e[13],x=e[14],y=e[15];return t[0]=s*(c*y-v*x)-f*(l*y-u*x)+d*(l*v-u*c),t[1]=-(n*(c*y-v*x)-f*(a*y-i*x)+d*(a*v-i*c)),t[2]=n*(l*y-u*x)-s*(a*y-i*x)+d*(a*u-i*l),t[3]=-(n*(l*v-u*c)-s*(a*v-i*c)+f*(a*u-i*l)),t[4]=-(o*(c*y-v*x)-h*(l*y-u*x)+p*(l*v-u*c)),t[5]=r*(c*y-v*x)-h*(a*y-i*x)+p*(a*v-i*c),t[6]=-(r*(l*y-u*x)-o*(a*y-i*x)+p*(a*u-i*l)),t[7]=r*(l*v-u*c)-o*(a*v-i*c)+h*(a*u-i*l),t[8]=o*(f*y-v*d)-h*(s*y-u*d)+p*(s*v-u*f),t[9]=-(r*(f*y-v*d)-h*(n*y-i*d)+p*(n*v-i*f)),t[10]=r*(s*y-u*d)-o*(n*y-i*d)+p*(n*u-i*s),t[11]=-(r*(s*v-u*f)-o*(n*v-i*f)+h*(n*u-i*s)),t[12]=-(o*(f*x-c*d)-h*(s*x-l*d)+p*(s*c-l*f)),t[13]=r*(f*x-c*d)-h*(n*x-a*d)+p*(n*c-a*f),t[14]=-(r*(s*x-l*d)-o*(n*x-a*d)+p*(n*l-a*s)),t[15]=r*(s*c-l*f)-o*(n*c-a*f)+h*(n*l-a*s),t},bt.SIMD.adjoint=function(t,e){var r,n,a,i,o,s,l,u,h,f,c,v,p,r=SIMD.Float32x4.load(e,0),n=SIMD.Float32x4.load(e,4),a=SIMD.Float32x4.load(e,8),i=SIMD.Float32x4.load(e,12);return h=SIMD.Float32x4.shuffle(r,n,0,1,4,5),s=SIMD.Float32x4.shuffle(a,i,0,1,4,5),o=SIMD.Float32x4.shuffle(h,s,0,2,4,6),s=SIMD.Float32x4.shuffle(s,h,1,3,5,7),h=SIMD.Float32x4.shuffle(r,n,2,3,6,7),u=SIMD.Float32x4.shuffle(a,i,2,3,6,7),l=SIMD.Float32x4.shuffle(h,u,0,2,4,6),u=SIMD.Float32x4.shuffle(u,h,1,3,5,7),h=SIMD.Float32x4.mul(l,u),h=SIMD.Float32x4.swizzle(h,1,0,3,2),f=SIMD.Float32x4.mul(s,h),c=SIMD.Float32x4.mul(o,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,h),f),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,h),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),h=SIMD.Float32x4.mul(s,l),h=SIMD.Float32x4.swizzle(h,1,0,3,2),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,h),f),p=SIMD.Float32x4.mul(o,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(u,h)),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,h),p),p=SIMD.Float32x4.swizzle(p,2,3,0,1),h=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,3,0,1),u),h=SIMD.Float32x4.swizzle(h,1,0,3,2),l=SIMD.Float32x4.swizzle(l,2,3,0,1),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,h),f),v=SIMD.Float32x4.mul(o,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(l,h)),v=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,h),v),v=SIMD.Float32x4.swizzle(v,2,3,0,1),h=SIMD.Float32x4.mul(o,s),h=SIMD.Float32x4.swizzle(h,1,0,3,2),v=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,h),v),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,h),p),h=SIMD.Float32x4.swizzle(h,2,3,0,1),v=SIMD.Float32x4.sub(SIMD.Float32x4.mul(u,h),v),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(l,h)),h=SIMD.Float32x4.mul(o,u),h=SIMD.Float32x4.swizzle(h,1,0,3,2),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(l,h)),v=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,h),v),h=SIMD.Float32x4.swizzle(h,2,3,0,1),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,h),c),v=SIMD.Float32x4.sub(v,SIMD.Float32x4.mul(s,h)),h=SIMD.Float32x4.mul(o,l),h=SIMD.Float32x4.swizzle(h,1,0,3,2),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,h),c),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(s,h)),h=SIMD.Float32x4.swizzle(h,2,3,0,1),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(u,h)),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,h),p),SIMD.Float32x4.store(t,0,f),SIMD.Float32x4.store(t,4,c),SIMD.Float32x4.store(t,8,v),SIMD.Float32x4.store(t,12,p),t},bt.adjoint=St.USE_SIMD?bt.SIMD.adjoint:bt.scalar.adjoint,bt.determinant=function(t){var e=t[0],r=t[1],n=t[2],a=t[3],i=t[4],o=t[5],s=t[6],l=t[7],u=t[8],h=t[9],f=t[10],c=t[11],v=t[12],p=t[13],d=t[14],x=t[15],y=e*o-r*i,M=e*s-n*i,g=e*l-a*i,m=r*s-n*o,_=r*l-a*o,S=n*l-a*s,b=u*p-h*v,I=u*d-f*v,F=u*x-c*v,D=h*d-f*p,A=h*x-c*p,w=f*x-c*d;return y*w-M*A+g*D+m*F-_*I+S*b},bt.SIMD.multiply=function(t,e,r){var n=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,4),i=SIMD.Float32x4.load(e,8),o=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4.load(r,0),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,1,1,1,1),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,2,2,2),i),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,3,3,3,3),o))));SIMD.Float32x4.store(t,0,l);var u=SIMD.Float32x4.load(r,4),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,1,1,1,1),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,2,2,2,2),i),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,3,3,3,3),o))));SIMD.Float32x4.store(t,4,h);var f=SIMD.Float32x4.load(r,8),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,1,1,1,1),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,2,2,2,2),i),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,3,3,3,3),o))));SIMD.Float32x4.store(t,8,c);var v=SIMD.Float32x4.load(r,12),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(v,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(v,1,1,1,1),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(v,2,2,2,2),i),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(v,3,3,3,3),o))));return SIMD.Float32x4.store(t,12,p),t},bt.scalar.multiply=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=e[3],s=e[4],l=e[5],u=e[6],h=e[7],f=e[8],c=e[9],v=e[10],p=e[11],d=e[12],x=e[13],y=e[14],M=e[15],g=r[0],m=r[1],_=r[2],S=r[3];return t[0]=g*n+m*s+_*f+S*d,t[1]=g*a+m*l+_*c+S*x,t[2]=g*i+m*u+_*v+S*y,t[3]=g*o+m*h+_*p+S*M,g=r[4],m=r[5],_=r[6],S=r[7],t[4]=g*n+m*s+_*f+S*d,t[5]=g*a+m*l+_*c+S*x,t[6]=g*i+m*u+_*v+S*y,t[7]=g*o+m*h+_*p+S*M,g=r[8],m=r[9],_=r[10],S=r[11],t[8]=g*n+m*s+_*f+S*d,t[9]=g*a+m*l+_*c+S*x,t[10]=g*i+m*u+_*v+S*y,t[11]=g*o+m*h+_*p+S*M,g=r[12],m=r[13],_=r[14],S=r[15],t[12]=g*n+m*s+_*f+S*d,t[13]=g*a+m*l+_*c+S*x,t[14]=g*i+m*u+_*v+S*y,t[15]=g*o+m*h+_*p+S*M,t},bt.multiply=St.USE_SIMD?bt.SIMD.multiply:bt.scalar.multiply,bt.mul=bt.multiply,bt.scalar.translate=function(t,e,r){var n,a,i,o,s,l,u,h,f,c,v,p,d=r[0],x=r[1],y=r[2];return e===t?(t[12]=e[0]*d+e[4]*x+e[8]*y+e[12],t[13]=e[1]*d+e[5]*x+e[9]*y+e[13],t[14]=e[2]*d+e[6]*x+e[10]*y+e[14],t[15]=e[3]*d+e[7]*x+e[11]*y+e[15]):(n=e[0],a=e[1],i=e[2],o=e[3],s=e[4],l=e[5],u=e[6],h=e[7],f=e[8],c=e[9],v=e[10],p=e[11],t[0]=n,t[1]=a,t[2]=i,t[3]=o,t[4]=s,t[5]=l,t[6]=u,t[7]=h,t[8]=f,t[9]=c,t[10]=v,t[11]=p,t[12]=n*d+s*x+f*y+e[12],t[13]=a*d+l*x+c*y+e[13],t[14]=i*d+u*x+v*y+e[14],t[15]=o*d+h*x+p*y+e[15]),t},bt.SIMD.translate=function(t,e,r){var n=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,4),i=SIMD.Float32x4.load(e,8),o=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4(r[0],r[1],r[2],0);e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11]),n=SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(s,0,0,0,0)),a=SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(s,1,1,1,1)),i=SIMD.Float32x4.mul(i,SIMD.Float32x4.swizzle(s,2,2,2,2));var l=SIMD.Float32x4.add(n,SIMD.Float32x4.add(a,SIMD.Float32x4.add(i,o)));return SIMD.Float32x4.store(t,12,l),t},bt.translate=St.USE_SIMD?bt.SIMD.translate:bt.scalar.translate,bt.scalar.scale=function(t,e,r){var n=r[0],a=r[1],i=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},bt.SIMD.scale=function(t,e,r){var n,a,i,o=SIMD.Float32x4(r[0],r[1],r[2],0);return n=SIMD.Float32x4.load(e,0),SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(o,0,0,0,0))),a=SIMD.Float32x4.load(e,4),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(o,1,1,1,1))),i=SIMD.Float32x4.load(e,8),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(i,SIMD.Float32x4.swizzle(o,2,2,2,2))),t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},bt.scale=St.USE_SIMD?bt.SIMD.scale:bt.scalar.scale,bt.rotate=function(t,e,r,n){var a,i,o,s,l,u,h,f,c,v,p,d,x,y,M,g,m,_,S,b,I,F,D,A,w=n[0],E=n[1],R=n[2],P=Math.sqrt(w*w+E*E+R*R);return Math.abs(P)<St.EPSILON?null:(P=1/P,w*=P,E*=P,R*=P,a=Math.sin(r),i=Math.cos(r),o=1-i,s=e[0],l=e[1],u=e[2],h=e[3],f=e[4],c=e[5],v=e[6],p=e[7],d=e[8],x=e[9],y=e[10],M=e[11],g=w*w*o+i,m=E*w*o+R*a,_=R*w*o-E*a,S=w*E*o-R*a,b=E*E*o+i,I=R*E*o+w*a,F=w*R*o+E*a,D=E*R*o-w*a,A=R*R*o+i,t[0]=s*g+f*m+d*_,t[1]=l*g+c*m+x*_,t[2]=u*g+v*m+y*_,t[3]=h*g+p*m+M*_,t[4]=s*S+f*b+d*I,t[5]=l*S+c*b+x*I,t[6]=u*S+v*b+y*I,t[7]=h*S+p*b+M*I,t[8]=s*F+f*D+d*A,t[9]=l*F+c*D+x*A,t[10]=u*F+v*D+y*A,t[11]=h*F+p*D+M*A,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},bt.scalar.rotateX=function(t,e,r){var n=Math.sin(r),a=Math.cos(r),i=e[4],o=e[5],s=e[6],l=e[7],u=e[8],h=e[9],f=e[10],c=e[11];
return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*a+u*n,t[5]=o*a+h*n,t[6]=s*a+f*n,t[7]=l*a+c*n,t[8]=u*a-i*n,t[9]=h*a-o*n,t[10]=f*a-s*n,t[11]=c*a-l*n,t},bt.SIMD.rotateX=function(t,e,r){var n=SIMD.Float32x4.splat(Math.sin(r)),a=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var i=SIMD.Float32x4.load(e,4),o=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(i,a),SIMD.Float32x4.mul(o,n))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,a),SIMD.Float32x4.mul(i,n))),t},bt.rotateX=St.USE_SIMD?bt.SIMD.rotateX:bt.scalar.rotateX,bt.scalar.rotateY=function(t,e,r){var n=Math.sin(r),a=Math.cos(r),i=e[0],o=e[1],s=e[2],l=e[3],u=e[8],h=e[9],f=e[10],c=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*a-u*n,t[1]=o*a-h*n,t[2]=s*a-f*n,t[3]=l*a-c*n,t[8]=i*n+u*a,t[9]=o*n+h*a,t[10]=s*n+f*a,t[11]=l*n+c*a,t},bt.SIMD.rotateY=function(t,e,r){var n=SIMD.Float32x4.splat(Math.sin(r)),a=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var i=SIMD.Float32x4.load(e,0),o=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,a),SIMD.Float32x4.mul(o,n))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(i,n),SIMD.Float32x4.mul(o,a))),t},bt.rotateY=St.USE_SIMD?bt.SIMD.rotateY:bt.scalar.rotateY,bt.scalar.rotateZ=function(t,e,r){var n=Math.sin(r),a=Math.cos(r),i=e[0],o=e[1],s=e[2],l=e[3],u=e[4],h=e[5],f=e[6],c=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*a+u*n,t[1]=o*a+h*n,t[2]=s*a+f*n,t[3]=l*a+c*n,t[4]=u*a-i*n,t[5]=h*a-o*n,t[6]=f*a-s*n,t[7]=c*a-l*n,t},bt.SIMD.rotateZ=function(t,e,r){var n=SIMD.Float32x4.splat(Math.sin(r)),a=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var i=SIMD.Float32x4.load(e,0),o=SIMD.Float32x4.load(e,4);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(i,a),SIMD.Float32x4.mul(o,n))),SIMD.Float32x4.store(t,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,a),SIMD.Float32x4.mul(i,n))),t},bt.rotateZ=St.USE_SIMD?bt.SIMD.rotateZ:bt.scalar.rotateZ,bt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},bt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},bt.fromRotation=function(t,e,r){var n,a,i,o=r[0],s=r[1],l=r[2],u=Math.sqrt(o*o+s*s+l*l);return Math.abs(u)<St.EPSILON?null:(u=1/u,o*=u,s*=u,l*=u,n=Math.sin(e),a=Math.cos(e),i=1-a,t[0]=o*o*i+a,t[1]=s*o*i+l*n,t[2]=l*o*i-s*n,t[3]=0,t[4]=o*s*i-l*n,t[5]=s*s*i+a,t[6]=l*s*i+o*n,t[7]=0,t[8]=o*l*i+s*n,t[9]=s*l*i-o*n,t[10]=l*l*i+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},bt.fromXRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},bt.fromYRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},bt.fromZRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},bt.fromRotationTranslation=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=e[3],s=n+n,l=a+a,u=i+i,h=n*s,f=n*l,c=n*u,v=a*l,p=a*u,d=i*u,x=o*s,y=o*l,M=o*u;return t[0]=1-(v+d),t[1]=f+M,t[2]=c-y,t[3]=0,t[4]=f-M,t[5]=1-(h+d),t[6]=p+x,t[7]=0,t[8]=c+y,t[9]=p-x,t[10]=1-(h+v),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},bt.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},bt.getRotation=function(t,e){var r=e[0]+e[5]+e[10],n=0;return r>0?(n=2*Math.sqrt(r+1),t[3]=.25*n,t[0]=(e[6]-e[9])/n,t[1]=(e[8]-e[2])/n,t[2]=(e[1]-e[4])/n):e[0]>e[5]&e[0]>e[10]?(n=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/n,t[0]=.25*n,t[1]=(e[1]+e[4])/n,t[2]=(e[8]+e[2])/n):e[5]>e[10]?(n=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/n,t[0]=(e[1]+e[4])/n,t[1]=.25*n,t[2]=(e[6]+e[9])/n):(n=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/n,t[0]=(e[8]+e[2])/n,t[1]=(e[6]+e[9])/n,t[2]=.25*n),t},bt.fromRotationTranslationScale=function(t,e,r,n){var a=e[0],i=e[1],o=e[2],s=e[3],l=a+a,u=i+i,h=o+o,f=a*l,c=a*u,v=a*h,p=i*u,d=i*h,x=o*h,y=s*l,M=s*u,g=s*h,m=n[0],_=n[1],S=n[2];return t[0]=(1-(p+x))*m,t[1]=(c+g)*m,t[2]=(v-M)*m,t[3]=0,t[4]=(c-g)*_,t[5]=(1-(f+x))*_,t[6]=(d+y)*_,t[7]=0,t[8]=(v+M)*S,t[9]=(d-y)*S,t[10]=(1-(f+p))*S,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},bt.fromRotationTranslationScaleOrigin=function(t,e,r,n,a){var i=e[0],o=e[1],s=e[2],l=e[3],u=i+i,h=o+o,f=s+s,c=i*u,v=i*h,p=i*f,d=o*h,x=o*f,y=s*f,M=l*u,g=l*h,m=l*f,_=n[0],S=n[1],b=n[2],I=a[0],F=a[1],D=a[2];return t[0]=(1-(d+y))*_,t[1]=(v+m)*_,t[2]=(p-g)*_,t[3]=0,t[4]=(v-m)*S,t[5]=(1-(c+y))*S,t[6]=(x+M)*S,t[7]=0,t[8]=(p+g)*b,t[9]=(x-M)*b,t[10]=(1-(c+d))*b,t[11]=0,t[12]=r[0]+I-(t[0]*I+t[4]*F+t[8]*D),t[13]=r[1]+F-(t[1]*I+t[5]*F+t[9]*D),t[14]=r[2]+D-(t[2]*I+t[6]*F+t[10]*D),t[15]=1,t},bt.fromQuat=function(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],o=r+r,s=n+n,l=a+a,u=r*o,h=n*o,f=n*s,c=a*o,v=a*s,p=a*l,d=i*o,x=i*s,y=i*l;return t[0]=1-f-p,t[1]=h+y,t[2]=c-x,t[3]=0,t[4]=h-y,t[5]=1-u-p,t[6]=v+d,t[7]=0,t[8]=c+x,t[9]=v-d,t[10]=1-u-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},bt.frustum=function(t,e,r,n,a,i,o){var s=1/(r-e),l=1/(a-n),u=1/(i-o);return t[0]=2*i*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*i*l,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(a+n)*l,t[10]=(o+i)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*i*2*u,t[15]=0,t},bt.perspective=function(t,e,r,n,a){var i=1/Math.tan(e/2),o=1/(n-a);return t[0]=i/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(a+n)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*a*n*o,t[15]=0,t},bt.perspectiveFromFieldOfView=function(t,e,r,n){var a=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+s),u=2/(a+i);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((o-s)*l*.5),t[9]=(a-i)*u*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t},bt.ortho=function(t,e,r,n,a,i,o){var s=1/(e-r),l=1/(n-a),u=1/(i-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*s,t[13]=(a+n)*l,t[14]=(o+i)*u,t[15]=1,t},bt.lookAt=function(t,e,r,n){var a,i,o,s,l,u,h,f,c,v,p=e[0],d=e[1],x=e[2],y=n[0],M=n[1],g=n[2],m=r[0],_=r[1],S=r[2];return Math.abs(p-m)<St.EPSILON&&Math.abs(d-_)<St.EPSILON&&Math.abs(x-S)<St.EPSILON?bt.identity(t):(h=p-m,f=d-_,c=x-S,v=1/Math.sqrt(h*h+f*f+c*c),h*=v,f*=v,c*=v,a=M*c-g*f,i=g*h-y*c,o=y*f-M*h,v=Math.sqrt(a*a+i*i+o*o),v?(v=1/v,a*=v,i*=v,o*=v):(a=0,i=0,o=0),s=f*o-c*i,l=c*a-h*o,u=h*i-f*a,v=Math.sqrt(s*s+l*l+u*u),v?(v=1/v,s*=v,l*=v,u*=v):(s=0,l=0,u=0),t[0]=a,t[1]=s,t[2]=h,t[3]=0,t[4]=i,t[5]=l,t[6]=f,t[7]=0,t[8]=o,t[9]=u,t[10]=c,t[11]=0,t[12]=-(a*p+i*d+o*x),t[13]=-(s*p+l*d+u*x),t[14]=-(h*p+f*d+c*x),t[15]=1,t)},bt.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},bt.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},bt.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},bt.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t},bt.sub=bt.subtract,bt.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},bt.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t},bt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},bt.equals=function(t,e){var r=t[0],n=t[1],a=t[2],i=t[3],o=t[4],s=t[5],l=t[6],u=t[7],h=t[8],f=t[9],c=t[10],v=t[11],p=t[12],d=t[13],x=t[14],y=t[15],M=e[0],g=e[1],m=e[2],_=e[3],S=e[4],b=e[5],I=e[6],F=e[7],D=e[8],A=e[9],w=e[10],E=e[11],R=e[12],P=e[13],z=e[14],C=e[15];return Math.abs(r-M)<=St.EPSILON*Math.max(1,Math.abs(r),Math.abs(M))&&Math.abs(n-g)<=St.EPSILON*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(a-m)<=St.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(i-_)<=St.EPSILON*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(o-S)<=St.EPSILON*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(s-b)<=St.EPSILON*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(l-I)<=St.EPSILON*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(u-F)<=St.EPSILON*Math.max(1,Math.abs(u),Math.abs(F))&&Math.abs(h-D)<=St.EPSILON*Math.max(1,Math.abs(h),Math.abs(D))&&Math.abs(f-A)<=St.EPSILON*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(c-w)<=St.EPSILON*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(v-E)<=St.EPSILON*Math.max(1,Math.abs(v),Math.abs(E))&&Math.abs(p-R)<=St.EPSILON*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(d-P)<=St.EPSILON*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(x-z)<=St.EPSILON*Math.max(1,Math.abs(x),Math.abs(z))&&Math.abs(y-C)<=St.EPSILON*Math.max(1,Math.abs(y),Math.abs(C))};var It=bt,Ft=Mt,Dt={};Dt.create=function(){var t=new Ft.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},Dt.clone=function(t){var e=new Ft.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Dt.fromValues=function(t,e,r){var n=new Ft.ARRAY_TYPE(3);return n[0]=t,n[1]=e,n[2]=r,n},Dt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Dt.set=function(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t},Dt.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},Dt.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},Dt.sub=Dt.subtract,Dt.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t},Dt.mul=Dt.multiply,Dt.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},Dt.div=Dt.divide,Dt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Dt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Dt.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},Dt.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},Dt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Dt.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},Dt.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t},Dt.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2];return Math.sqrt(r*r+n*n+a*a)},Dt.dist=Dt.distance,Dt.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2];return r*r+n*n+a*a},Dt.sqrDist=Dt.squaredDistance,Dt.length=function(t){var e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)},Dt.len=Dt.length,Dt.squaredLength=function(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n},Dt.sqrLen=Dt.squaredLength,Dt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Dt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Dt.normalize=function(t,e){var r=e[0],n=e[1],a=e[2],i=r*r+n*n+a*a;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i),t},Dt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},Dt.cross=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=r[0],s=r[1],l=r[2];return t[0]=a*l-i*s,t[1]=i*o-n*l,t[2]=n*s-a*o,t},Dt.lerp=function(t,e,r,n){var a=e[0],i=e[1],o=e[2];return t[0]=a+n*(r[0]-a),t[1]=i+n*(r[1]-i),t[2]=o+n*(r[2]-o),t},Dt.hermite=function(t,e,r,n,a,i){var o=i*i,s=o*(2*i-3)+1,l=o*(i-2)+i,u=o*(i-1),h=o*(3-2*i);return t[0]=e[0]*s+r[0]*l+n[0]*u+a[0]*h,t[1]=e[1]*s+r[1]*l+n[1]*u+a[1]*h,t[2]=e[2]*s+r[2]*l+n[2]*u+a[2]*h,t},Dt.bezier=function(t,e,r,n,a,i){var o=1-i,s=o*o,l=i*i,u=s*o,h=3*i*s,f=3*l*o,c=l*i;return t[0]=e[0]*u+r[0]*h+n[0]*f+a[0]*c,t[1]=e[1]*u+r[1]*h+n[1]*f+a[1]*c,t[2]=e[2]*u+r[2]*h+n[2]*f+a[2]*c,t},Dt.random=function(t,e){e=e||1;var r=2*Ft.RANDOM()*Math.PI,n=2*Ft.RANDOM()-1,a=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*a,t[1]=Math.sin(r)*a,t[2]=n*e,t},Dt.transformMat4=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=r[3]*n+r[7]*a+r[11]*i+r[15];return o=o||1,t[0]=(r[0]*n+r[4]*a+r[8]*i+r[12])/o,t[1]=(r[1]*n+r[5]*a+r[9]*i+r[13])/o,t[2]=(r[2]*n+r[6]*a+r[10]*i+r[14])/o,t},Dt.transformMat3=function(t,e,r){var n=e[0],a=e[1],i=e[2];return t[0]=n*r[0]+a*r[3]+i*r[6],t[1]=n*r[1]+a*r[4]+i*r[7],t[2]=n*r[2]+a*r[5]+i*r[8],t},Dt.transformQuat=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=r[0],s=r[1],l=r[2],u=r[3],h=u*n+s*i-l*a,f=u*a+l*n-o*i,c=u*i+o*a-s*n,v=-o*n-s*a-l*i;return t[0]=h*u+v*-o+f*-l-c*-s,t[1]=f*u+v*-s+c*-o-h*-l,t[2]=c*u+v*-l+h*-s-f*-o,t},Dt.rotateX=function(t,e,r,n){var a=[],i=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],i[0]=a[0],i[1]=a[1]*Math.cos(n)-a[2]*Math.sin(n),i[2]=a[1]*Math.sin(n)+a[2]*Math.cos(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t},Dt.rotateY=function(t,e,r,n){var a=[],i=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],i[0]=a[2]*Math.sin(n)+a[0]*Math.cos(n),i[1]=a[1],i[2]=a[2]*Math.cos(n)-a[0]*Math.sin(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t},Dt.rotateZ=function(t,e,r,n){var a=[],i=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],i[0]=a[0]*Math.cos(n)-a[1]*Math.sin(n),i[1]=a[0]*Math.sin(n)+a[1]*Math.cos(n),i[2]=a[2],t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t},Dt.forEach=function(){var t=Dt.create();return function(e,r,n,a,i,o){var s,l;for(r||(r=3),n||(n=0),l=a?Math.min(a*r+n,e.length):e.length,s=n;s<l;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],i(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),Dt.angle=function(t,e){var r=Dt.fromValues(t[0],t[1],t[2]),n=Dt.fromValues(e[0],e[1],e[2]);Dt.normalize(r,r),Dt.normalize(n,n);var a=Dt.dot(r,n);return a>1?0:Math.acos(a)},Dt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Dt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Dt.equals=function(t,e){var r=t[0],n=t[1],a=t[2],i=e[0],o=e[1],s=e[2];return Math.abs(r-i)<=Ft.EPSILON*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-o)<=Ft.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(a-s)<=Ft.EPSILON*Math.max(1,Math.abs(a),Math.abs(s))};var At=Dt,wt=Mt,Et={};Et.create=function(){var t=new wt.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Et.clone=function(t){var e=new wt.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Et.fromValues=function(t,e,r,n){var a=new wt.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=r,a[3]=n,a},Et.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Et.set=function(t,e,r,n,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t},Et.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},Et.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t},Et.sub=Et.subtract,Et.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t},Et.mul=Et.multiply,Et.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t},Et.div=Et.divide,Et.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Et.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Et.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},Et.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},Et.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Et.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},Et.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t},Et.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2],i=e[3]-t[3];return Math.sqrt(r*r+n*n+a*a+i*i)},Et.dist=Et.distance,Et.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2],i=e[3]-t[3];return r*r+n*n+a*a+i*i},Et.sqrDist=Et.squaredDistance,Et.length=function(t){var e=t[0],r=t[1],n=t[2],a=t[3];return Math.sqrt(e*e+r*r+n*n+a*a)},Et.len=Et.length,Et.squaredLength=function(t){var e=t[0],r=t[1],n=t[2],a=t[3];return e*e+r*r+n*n+a*a},Et.sqrLen=Et.squaredLength,Et.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Et.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Et.normalize=function(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],o=r*r+n*n+a*a+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=r*o,t[1]=n*o,t[2]=a*o,t[3]=i*o),t},Et.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Et.lerp=function(t,e,r,n){var a=e[0],i=e[1],o=e[2],s=e[3];return t[0]=a+n*(r[0]-a),t[1]=i+n*(r[1]-i),t[2]=o+n*(r[2]-o),t[3]=s+n*(r[3]-s),t},Et.random=function(t,e){return e=e||1,t[0]=wt.RANDOM(),t[1]=wt.RANDOM(),t[2]=wt.RANDOM(),t[3]=wt.RANDOM(),Et.normalize(t,t),Et.scale(t,t,e),t},Et.transformMat4=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=e[3];return t[0]=r[0]*n+r[4]*a+r[8]*i+r[12]*o,t[1]=r[1]*n+r[5]*a+r[9]*i+r[13]*o,t[2]=r[2]*n+r[6]*a+r[10]*i+r[14]*o,t[3]=r[3]*n+r[7]*a+r[11]*i+r[15]*o,t},Et.transformQuat=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=r[0],s=r[1],l=r[2],u=r[3],h=u*n+s*i-l*a,f=u*a+l*n-o*i,c=u*i+o*a-s*n,v=-o*n-s*a-l*i;return t[0]=h*u+v*-o+f*-l-c*-s,t[1]=f*u+v*-s+c*-o-h*-l,t[2]=c*u+v*-l+h*-s-f*-o,t[3]=e[3],t},Et.forEach=function(){var t=Et.create();return function(e,r,n,a,i,o){var s,l;for(r||(r=4),n||(n=0),l=a?Math.min(a*r+n,e.length):e.length,s=n;s<l;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],i(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),Et.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Et.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Et.equals=function(t,e){var r=t[0],n=t[1],a=t[2],i=t[3],o=e[0],s=e[1],l=e[2],u=e[3];return Math.abs(r-o)<=wt.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=wt.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(a-l)<=wt.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(i-u)<=wt.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))};var Rt=Et,Pt=Mt,zt=_t,Ct=At,Tt=Rt,Bt={};Bt.create=function(){var t=new Pt.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Bt.rotationTo=function(){var t=Ct.create(),e=Ct.fromValues(1,0,0),r=Ct.fromValues(0,1,0);return function(n,a,i){var o=Ct.dot(a,i);return o<-.999999?(Ct.cross(t,e,a),Ct.length(t)<1e-6&&Ct.cross(t,r,a),Ct.normalize(t,t),Bt.setAxisAngle(n,t,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Ct.cross(t,a,i),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+o,Bt.normalize(n,n))}}(),Bt.setAxes=function(){var t=zt.create();return function(e,r,n,a){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=a[0],t[4]=a[1],t[7]=a[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],Bt.normalize(e,Bt.fromMat3(e,t))}}(),Bt.clone=Tt.clone,Bt.fromValues=Tt.fromValues,Bt.copy=Tt.copy,Bt.set=Tt.set,Bt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Bt.setAxisAngle=function(t,e,r){r*=.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t},Bt.getAxisAngle=function(t,e){var r=2*Math.acos(e[3]),n=Math.sin(r/2);return 0!=n?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r},Bt.add=Tt.add,Bt.multiply=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=e[3],s=r[0],l=r[1],u=r[2],h=r[3];return t[0]=n*h+o*s+a*u-i*l,t[1]=a*h+o*l+i*s-n*u,t[2]=i*h+o*u+n*l-a*s,t[3]=o*h-n*s-a*l-i*u,t},Bt.mul=Bt.multiply,Bt.scale=Tt.scale,Bt.rotateX=function(t,e,r){r*=.5;var n=e[0],a=e[1],i=e[2],o=e[3],s=Math.sin(r),l=Math.cos(r);return t[0]=n*l+o*s,t[1]=a*l+i*s,t[2]=i*l-a*s,t[3]=o*l-n*s,t},Bt.rotateY=function(t,e,r){r*=.5;var n=e[0],a=e[1],i=e[2],o=e[3],s=Math.sin(r),l=Math.cos(r);return t[0]=n*l-i*s,t[1]=a*l+o*s,t[2]=i*l+n*s,t[3]=o*l-a*s,t},Bt.rotateZ=function(t,e,r){r*=.5;var n=e[0],a=e[1],i=e[2],o=e[3],s=Math.sin(r),l=Math.cos(r);return t[0]=n*l+a*s,t[1]=a*l-n*s,t[2]=i*l+o*s,t[3]=o*l-i*s,t},Bt.calculateW=function(t,e){var r=e[0],n=e[1],a=e[2];return t[0]=r,t[1]=n,t[2]=a,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-a*a)),t},Bt.dot=Tt.dot,Bt.lerp=Tt.lerp,Bt.slerp=function(t,e,r,n){var a,i,o,s,l,u=e[0],h=e[1],f=e[2],c=e[3],v=r[0],p=r[1],d=r[2],x=r[3];return i=u*v+h*p+f*d+c*x,i<0&&(i=-i,v=-v,p=-p,d=-d,x=-x),1-i>1e-6?(a=Math.acos(i),o=Math.sin(a),s=Math.sin((1-n)*a)/o,l=Math.sin(n*a)/o):(s=1-n,l=n),t[0]=s*u+l*v,t[1]=s*h+l*p,t[2]=s*f+l*d,t[3]=s*c+l*x,t},Bt.sqlerp=function(){var t=Bt.create(),e=Bt.create();return function(r,n,a,i,o,s){return Bt.slerp(t,n,o,s),Bt.slerp(e,a,i,s),Bt.slerp(r,t,e,2*s*(1-s)),r}}(),Bt.invert=function(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],o=r*r+n*n+a*a+i*i,s=o?1/o:0;return t[0]=-r*s,t[1]=-n*s,t[2]=-a*s,t[3]=i*s,t},Bt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Bt.length=Tt.length,Bt.len=Bt.length,Bt.squaredLength=Tt.squaredLength,Bt.sqrLen=Bt.squaredLength,Bt.normalize=Tt.normalize,Bt.fromMat3=function(t,e){var r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[3*a+a]&&(a=2);var i=(a+1)%3,o=(a+2)%3;r=Math.sqrt(e[3*a+a]-e[3*i+i]-e[3*o+o]+1),t[a]=.5*r,r=.5/r,t[3]=(e[3*i+o]-e[3*o+i])*r,t[i]=(e[3*i+a]+e[3*a+i])*r,t[o]=(e[3*o+a]+e[3*a+o])*r}return t},Bt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Bt.exactEquals=Tt.exactEquals,Bt.equals=Tt.equals;var Lt=Mt,kt={};kt.create=function(){var t=new Lt.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},kt.clone=function(t){var e=new Lt.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},kt.fromValues=function(t,e){var r=new Lt.ARRAY_TYPE(2);return r[0]=t,r[1]=e,r},kt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},kt.set=function(t,e,r){return t[0]=e,t[1]=r,t},kt.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},kt.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t},kt.sub=kt.subtract,kt.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t},kt.mul=kt.multiply,kt.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t},kt.div=kt.divide,kt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},kt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},kt.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},kt.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},kt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},kt.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},kt.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t},kt.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)},kt.dist=kt.distance,kt.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n},kt.sqrDist=kt.squaredDistance,kt.length=function(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)},kt.len=kt.length,kt.squaredLength=function(t){var e=t[0],r=t[1];return e*e+r*r},kt.sqrLen=kt.squaredLength,kt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},kt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},kt.normalize=function(t,e){var r=e[0],n=e[1],a=r*r+n*n;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a),t},kt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},kt.cross=function(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t},kt.lerp=function(t,e,r,n){var a=e[0],i=e[1];return t[0]=a+n*(r[0]-a),t[1]=i+n*(r[1]-i),t},kt.random=function(t,e){e=e||1;var r=2*Lt.RANDOM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},kt.transformMat2=function(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[2]*a,t[1]=r[1]*n+r[3]*a,t},kt.transformMat2d=function(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[2]*a+r[4],t[1]=r[1]*n+r[3]*a+r[5],t},kt.transformMat3=function(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[3]*a+r[6],t[1]=r[1]*n+r[4]*a+r[7],t},kt.transformMat4=function(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[4]*a+r[12],t[1]=r[1]*n+r[5]*a+r[13],t},kt.forEach=function(){var t=kt.create();return function(e,r,n,a,i,o){var s,l;for(r||(r=2),n||(n=0),l=a?Math.min(a*r+n,e.length):e.length,s=n;s<l;s+=r)t[0]=e[s],t[1]=e[s+1],i(t,t,o),e[s]=t[0],e[s+1]=t[1];return e}}(),kt.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},kt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},kt.equals=function(t,e){var r=t[0],n=t[1],a=e[0],i=e[1];return Math.abs(r-a)<=Lt.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-i)<=Lt.EPSILON*Math.max(1,Math.abs(n),Math.abs(i))};var Nt=It,Ot=At,Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yt=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},qt=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):n(t,e))},Vt=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},jt=function(t){function e(r,n,a){Yt(this,e);var i=Vt(this,t.call(this,a));return i.gl=r,i.map=n,i}return qt(e,t),e}(e.Class),Zt=Math.PI/180,Wt=function(t){function r(){return Yt(this,r),Vt(this,t.apply(this,arguments))}return qt(r,t),r.prototype.createCanvas=function(){if(!this.canvas){var t=this.getMap(),r=t.getSize(),n=e.Browser.retina?2:1;this.canvas=e.Canvas.createCanvas(n*r.width,n*r.height,t.CanvasClass);var a=this.gl=this._createGLContext(this.canvas,this.layer.options.glOptions);a.clearColor(0,0,0,0),a.verbose=!0,a.blendFunc(a.SRC_ALPHA,a.ONE),a.enable(a.BLEND),a.disable(a.DEPTH_TEST),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.onCanvasCreate&&this.onCanvasCreate(),this.layer.options.doubleBuffer&&(this.buffer=e.Canvas.createCanvas(this.canvas.width,this.canvas.height,t.CanvasClass),this.context=this.buffer.getContext("2d"))}},r.prototype.resizeCanvas=function(t){if(this.canvas){var r=void 0;r=t?t:this.getMap().getSize();var n=e.Browser.retina?2:1;this.canvas.height=n*r.height,this.canvas.width=n*r.width,this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}},r.prototype.clearCanvas=function(){this.canvas&&(this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.context&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height))},r.prototype.prepareCanvas=function(){return this.context?t.prototype.prepareCanvas.call(this):(this.canvas?this.clearCanvas():this.createCanvas(),this.layer.fire("renderstart",{context:this.context,gl:this.gl}),null)},r.prototype.mergeSprites=function(t,r){if(!t||0===t.length)return null;var n=2,a=0,i=0;t.forEach(function(t){if(r){var e=Math.max(t.canvas.width,t.canvas.height);a+=e+n,e>i&&(i=e)}else a+=t.canvas.width+n,t.canvas.height>i&&(i=t.canvas.height)}),a=Math.pow(2,Math.ceil(Math.log(a)/Math.LN2)),i=Math.pow(2,Math.ceil(Math.log(i)/Math.LN2));var o=this.getMap(),s=e.Canvas.createCanvas(a,i,o.CanvasClass),l=s.getContext("2d"),u=[],h=[],f=[],c=0;t.forEach(function(t){var e=0,o=0,s=void 0;if(r){var v=t.canvas.width,p=t.canvas.height;s=Math.max(v,p),e=s>v?(s-v)/2:0,o=s>p?(s-p)/2:0,u.push([c/a,s/a,s/i,s]),f.push([v,p])}else s=t.canvas.width,u.push([c/a,t.canvas.width/a,t.canvas.height/i]);l.drawImage(t.canvas,c+e,o),h.push(t.offset),c+=s+n});var v={canvas:s,texCoords:u,offsets:h};return r&&(v.sizes=f),v},r.prototype.createBuffer=function(){var t=this.gl,e=t.createBuffer();if(!e)throw new Error("Failed to create the buffer object");return this._buffers||(this._buffers=[]),this._buffers.push(e),e},r.prototype.enableVertexAttrib=function(t){var e=this.gl;if(Array.isArray(t[0])){for(var r=new Float32Array([0,0,0]),n=r.BYTES_PER_ELEMENT,a=0,i=0;i<t.length;i++)a+=t[i][1]||0;for(var o=0,s=0;s<t.length;s++){var l=e.getAttribLocation(e.program,t[s][0]);if(l<0)throw new Error("Failed to get the storage location of "+t[s][0]);e.vertexAttribPointer(l,t[s][1],e[t[s][2]||"FLOAT"],!1,n*a,n*o),o+=t[s][1]||0,e.enableVertexAttribArray(l)}}else{var u=e.getAttribLocation(e.program,t[0]);e.vertexAttribPointer(u,t[1],e[t[2]||"FLOAT"],!1,0,0),e.enableVertexAttribArray(u)}},r.prototype.onRemove=function(){var t=this.gl;this._buffers&&(this._buffers.forEach(function(e){t.deleteBuffer(e)}),delete this._buffers)},r.prototype.createProgram=function(t,e,r){var n=this.gl,a=this._compileShader(n,n.VERTEX_SHADER,t),i=this._compileShader(n,n.FRAGMENT_SHADER,e);if(!a||!i)return null;var o=n.createProgram();if(!o)return null;n.attachShader(o,a),n.attachShader(o,i),n.linkProgram(o);var s=n.getProgramParameter(o,n.LINK_STATUS);if(!s){var l=n.getProgramInfoLog(o);throw n.deleteProgram(o),n.deleteShader(i),n.deleteShader(a),new Error("Failed to link program: "+l)}return this._initUniforms(o,r),o},r.prototype.useProgram=function(t){var e=this.gl;return e.useProgram(t),e.program=t,this},r.prototype.loadTexture=function(t,e){var r=this.gl,n=r.createTexture();if(!n)throw new Error("Failed to create the texture object");return e||(e=0),r.activeTexture(r["TEXTURE"+e]),r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t),n},r.prototype.enableSampler=function(t,e){var r=this.gl,n=this._getUniform(r.program,t);return e||(e=0),r.uniform1i(n,e),n},r.prototype._calcMatrices=function(){var t=this.getMap(),r=t.getSize(),n=t.getScale(),a=t._prjToPoint(t._getPrjCenter(),t.getMaxZoom()),i=t.getFov()*Math.PI/180,o=.5/Math.tan(i/2)*r.height*n,s=Nt.create();return Nt.perspective(s,i,r.width/r.height,1,o+1e9),e.Util.isNode||Nt.scale(s,s,[1,-1,1]),Nt.translate(s,s,[0,0,-o]),Nt.rotateX(s,s,t.getPitch()*Math.PI/180),Nt.rotateZ(s,s,-t.getBearing()*Math.PI/180),Nt.translate(s,s,[-a.x,-a.y,0]),s},r.prototype.calcMatrices=function(){var t=this.getMap(),r=t.getSize(),n=t.getFov()*Math.PI/180,a=t.getScale(t.getMinZoom())/t.getScale(t.getMaxNativeZoom()),i=a*r.height/2/this._getFovRatio(),o=Nt.create();Nt.perspective(o,n,r.width/r.height,1,i);var s=Nt.create();e.Util.isNode||Nt.scale(o,o,[1,-1,1]),Nt.copy(s,o);var l=this._getLookAtMat();return Nt.multiply(o,s,l),
o},r.prototype._getLookAtMat=function(){var t=this.getMap(),e=a(t),r=t.getSize(),n=t.getScale()/t.getScale(e),i=this.cameraCenter=t.coordinateToPoint(t.getCenter(),e),o=t.getPitch()*Zt,s=-t.getBearing()*Zt,l=this._getFovRatio(),u=n*r.height/2/l,h=u*Math.cos(o),f=Math.sin(o)*u,c=i.x+f*Math.sin(s),v=i.y+f*Math.cos(s),p=[Math.sin(s),Math.cos(s),0],d=Nt.create();return Nt.lookAt(d,[c,v,h],[i.x,i.y,0],p),d},r.prototype._getFovRatio=function(){var t=this.getMap(),e=t.getFov();return Math.tan(e/2*Math.PI/180)},r.prototype.hitDetect=function(t){var e=this.gl;if(!e)return!1;var r=new Uint8Array(4),n=this.getMap(),a=this.canvas.height,i=n._pointToContainerPoint(t)._round();return e.readPixels(i.x,a-i.y,1,1,e.RGBA,e.UNSIGNED_BYTE,r),r[3]>0},r.prototype.getCanvasImage=function(){var e=t.prototype.getCanvasImage.call(this);if(e&&e.image&&this.buffer){var r=e.image;this.buffer.width===r.width&&this.buffer.height===r.height&&this._preserveBuffer||(this.buffer.width=r.width,this.buffer.height=r.height),this._preserveBuffer||this.context.drawImage(r,0,0),e.image=this.buffer}return e},r.prototype.onZoomStart=function(){t.prototype.onZoomStart.apply(this,arguments)},r.prototype.onZoomEnd=function(){t.prototype.onZoomEnd.apply(this,arguments)},r.prototype._createGLContext=function(t,r){for(var n=e.Util.extend({alpha:!0,antialias:!0,preserveDrawingBuffer:!0},r),a=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=null,o=0;o<a.length;++o){try{i=t.getContext(a[o],n)}catch(t){}if(i)break}return i},r.prototype._compileShader=function(t,e,r){var n=t.createShader(e);if(null==n)throw new Error("unable to create shader");t.shaderSource(n,r),t.compileShader(n);var a=t.getShaderParameter(n,t.COMPILE_STATUS);if(!a){var i=t.getShaderInfoLog(n);throw t.deleteShader(n),new Error("Failed to compile shader: "+i)}return n},r.prototype._initUniforms=function(t,r){for(var n=0;n<r.length;n++){var a=r[n],i=r[n],o=a.indexOf("[");o>=0&&(a=a.substring(0,o),e.Util.isNode||(i=i.substring(0,o))),t[a]=this._getUniform(t,i)}},r.prototype._getUniform=function(t,e){var r=this.gl,n=r.getUniformLocation(t,e);if(!n)throw new Error("Failed to get the storage location of "+n);return n},r}(e.renderer.CanvasRenderer),Gt=function(){function t(e,r){Yt(this,t),this.resources=e,this.options=r||{},this.atlas={}}return t.prototype.getAtlas=function(t){var e=JSON.stringify(t);if(!this.atlas[e]){var r=this.addAtlas(t);r&&(this.atlas[e]=r)}return this.atlas[e]},t.prototype.addAtlas=function(t){if(!t.lineDasharray&&!t.linePatternFile)return null;var r=this._getSize(t,this.resources),n=this._createCanvas(r);if(!n)throw new Error("can not initialize canvas container.");var a=n.getContext("2d");return e.Canvas.prepareCanvas(a,t,this.resources),a.moveTo(0,r[1]/2),a.lineTo(r[0],r[1]/2),a.stroke(),{canvas:n,offset:new e.Point(0,0)}},t.prototype._getSize=function(t,e){var r=0,n=0,a=t.lineDasharray;if(a){for(var i=0;i<a.length;i++)r+=a[i];a.length%2===1&&(r*=2),n=null==t.lineWidth?2:t.lineWidth}if(t.linePatternFile){var o=e.getImage(t.linePatternFile);o.width>r&&(r=o.width),o.height>n&&(n=o.height)}return[r,n]},t.prototype._createCanvas=function(t){if(this.options.canvasClass)return new this.options.canvasClass(t[0],t[1]);if("undefined"!=typeof document){var e=document.createElement("canvas");return e.width=t[0],e.height=t[1],e}return null},t}(),Xt=i;i.prototype={clone:function(){return new i(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=e*this.x-r*this.y,a=r*this.x+e*this.y;return this.x=n,this.y=a,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),a=e.x+r*(this.x-e.x)-n*(this.y-e.y),i=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=a,this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},i.convert=function(t){return t instanceof i?t:Array.isArray(t)?new i(t[0],t[1]):t};var Jt={project:!0},Ht=function(t){function r(e,n,a){Yt(this,r);var i=Vt(this,t.call(this,e,n,a));return i.vertexArray=[],i.normalArray=[],i.elementArray=[],i.styleArray=[],i.distance=0,i}return qt(r,t),r.prototype.getArrays=function(){return{vertexArray:this.vertexArray,normalArray:this.normalArray,elementArray:this.elementArray,styleArray:this.styleArray}},r.prototype.addLine=function(t,r){if(!t)return this;if(r.symbol.lineWidth<=0||r.symbol.lineOpacity<=0)return this;var n=this.vertexArray.length,i=this._getVertice(t);if(i[0]&&Array.isArray(i[0][0])){for(var o=0,s=i.length;o<s;o++)this.addLine(i[o],r);return this}this._prepareToAdd();for(var l=a(this.map),u=void 0,h=void 0,f=0,c=i.length;f<c;f++){var v=i[f];this.options.project&&(v=this.map.coordinateToPoint(new e.Coordinate(v),l).toArray()),u=Xt.convert(v),f<c-1?(v=i[f+1],this.options.project&&(v=this.map.coordinateToPoint(new e.Coordinate(v),l).toArray()),h=Xt.convert(v)):h=null,this.addCurrentVertex(u,h)}var p=this.vertexArray.length-n;return this._addTexCoords(p,r),this},r.prototype.addCurrentVertex=function(t,e){if(!this.preVertex)return this.e1=this.e2=this.e3=-1,this._waitForLeftCap=!0,void(this.preVertex=t);var r=t.sub(this.preVertex)._unit()._perp()._mult(-1),n=void 0;e&&(n=e.sub(t)._unit()._perp()._mult(-1));var a=this._getStartNormal(r,this.preNormal);if(this._addLineEndVertexs(this.preVertex,a,this.distance),this.distance+=t.dist(this.preVertex),!e){var i=this._getEndNormal(r,n);this._addLineEndVertexs(t,i,this.distance)}this.preNormal=r,this.preVertex=t},r.prototype._prepareToAdd=function(){this.distance=0,delete this.preVertex,delete this.preNormal},r.prototype._addLineEndVertexs=function(t,e,r){var n=e.normal[0];this.e3=this._addVertex(t,n,r),this.e1>=0&&this.e2>=0&&this.elementArray.push(this.e1,this.e2,this.e3),this.e1=this.e2,this.e2=this.e3,n=e.normal[1],this.e3=this._addVertex(t,n,r),this.e1>=0&&this.e2>=0&&this.elementArray.push(this.e1,this.e2,this.e3),this.e1=this.e2,this.e2=this.e3},r.prototype._addVertex=function(t,r,n){this.vertexArray.push(t.x,t.y);var a=[this._precise(r.x),this._precise(r.y),n],i=this.normalArray.length/a.length;return e.Util.pushIn(this.normalArray,a),i},r.prototype._getVertice=function(t){return t.geometry?t=t.geometry.coordinates:t.coordinates&&(t=t.coordinates),t},r.prototype._addTexCoords=function(t,e){var r=(e.symbol.lineWidth||2)/2*100+10*(e.symbol.lineOpacity||1);r=1e4*r+e.index;for(var n=0;n<t;n++)this.styleArray.push(r)},r.prototype._getStartNormal=function(t,e){return this._getJoinNormal(t,e,t)},r.prototype._getEndNormal=function(t,e){return this._getJoinNormal(t,t,e)},r.prototype._getJoinNormal=function(t,e,r){if(!e||!r)return{normal:[t,t.mult(-1)]};var n=e.add(r)._unit(),a=n.x*r.x+n.y*r.y,i=1/a;return n._mult(i),{normal:[n,n.mult(-1)]}},r.prototype._precise=function(t){return Math.round(1e7*t)/1e7},r}(jt);Ht.mergeOptions(Jt);var Kt=o;o.deviation=function(t,e,r,n){var a=e&&e.length,i=a?e[0]*r:t.length,o=Math.abs(T(t,0,i,r));if(a)for(var s=0,l=e.length;s<l;s++){var u=e[s]*r,h=s<l-1?e[s+1]*r:t.length;o-=Math.abs(T(t,u,h,r))}var f=0;for(s=0;s<n.length;s+=3){var c=n[s]*r,v=n[s+1]*r,p=n[s+2]*r;f+=Math.abs((t[c]-t[p])*(t[v+1]-t[c+1])-(t[c]-t[v])*(t[p+1]-t[c+1]))}return 0===o&&0===f?0:Math.abs((f-o)/o)},o.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,a=0;a<t.length;a++){for(var i=0;i<t[a].length;i++)for(var o=0;o<e;o++)r.vertices.push(t[a][i][o]);a>0&&(n+=t[a-1].length,r.holes.push(n))}return r};var Qt={project:!0},$t=function(t){function r(e,n,a){Yt(this,r);var i=Vt(this,t.call(this,e,n,a));return i.vertexArray=[],i.elementArray=[],i.styleArray=[],i}return qt(r,t),r.prototype.getArrays=function(){return{vertexArray:this.vertexArray,elementArray:this.elementArray,styleArray:this.styleArray}},r.prototype.addPolygon=function(t,r){var n=this;if(!t)return this;if(r.symbol.polygonOpacity<=0)return this;var i=this._getVertice(t);if(i[0]&&Array.isArray(i[0][0])&&Array.isArray(i[0][0][0])){for(var o=0,s=i.length;o<s;o++)this.addPolygon(i[o],r);return this}i.forEach(function(t){t.length&&(n._equalCoord(t[0],t[t.length-1])||t.push(t[0],t[1]))});var l=a(this.map),u=Kt.flatten(i);if(this.options.project){for(var h=[],f=void 0,c=0,v=u.vertices.length;c<v;c+=2)f=this.map.coordinateToPoint(new e.Coordinate(u.vertices[c],u.vertices[c+1]),l),h.push(f.x,f.y);u.vertices=h}var p=Kt(u.vertices,u.holes,2);if(p.length<=2)return this;var d=Kt.deviation(u.vertices,u.holes,2,p);if(Math.round(1e3*d)/1e3!==0)return console&&console.warn("Failed triangluation."),this;var x=this.vertexArray.length/2;return x>0&&(p=p.map(function(t){return t+x})),e.Util.pushIn(this.vertexArray,u.vertices),e.Util.pushIn(this.elementArray,p),this._addTexCoords(u.vertices.length/2,r),this},r.prototype._getVertice=function(t){return t.geometry?t=t.geometry.coordinates:t.coordinates&&(t=t.coordinates),t},r.prototype._addTexCoords=function(t,e){for(var r=100*e.index+10*(e.symbol.polygonOpacity||1),n=0;n<t;n++)this.styleArray.push(r)},r.prototype._equalCoord=function(t,e){return t[0]===e[0]&&t[1]===e[1]},r}(jt);$t.mergeOptions(Qt);var te="#ifdef GL_ES\nprecision mediump float;\n#else\n#define lowp\n#define mediump\n#define highp\n#endif\n\nuniform float u_blur;\nuniform vec2 u_tex_size;\n\n// varying lowp vec4 v_color;\n// varying vec2 v_linenormal;\nvarying vec4 v_texcoord;\nvarying float v_opacity;\nvarying float v_linewidth;\nvarying float v_scale;\nvarying float v_texture_normal;\nvarying float v_linesofar;\n// varying float v_ruler;\n\nuniform sampler2D u_image;\n\nvoid main() {\n    vec4 color;\n    if (v_texcoord.q == -1.0) {\n        // is a texture fragment\n        float linesofar = v_linesofar / v_scale;\n        float texWidth = u_tex_size.x * v_texcoord.t;\n        float x = v_texcoord.s + mod(linesofar, texWidth) / texWidth * v_texcoord.t;\n        float y = (v_texture_normal + 1.0) / 2.0 * v_texcoord.p;\n\n        color = texture2D(u_image, vec2(x, y));\n    } else {\n        // a color fragment\n        color = v_texcoord;\n    }\n    float alpha = 1.0;\n    gl_FragColor = color * (alpha * v_opacity);\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}",ee=e.Browser.ie||e.Browser.edge?504:e.Util.isNode?1014:3900,re="#ifdef GL_ES\nprecision highp float;\n#else\n#define lowp\n#define mediump\n#define highp\n#endif\n\nattribute vec4 a_pos;\nattribute mediump vec2 a_normal;\n// attribute mediump vec2 a_linenormal;\nattribute float a_linesofar;\n// (line_width * 100 + opacity * 10) * 10000 + tex_idx\nattribute float a_style;\n// attribute float a_seglen;\n\nuniform mat4 u_matrix;\nuniform float u_scale;\nuniform float u_styles["+ee+"];\n\nvarying vec2 v_linenormal;\nvarying float v_linewidth;\nvarying float v_opacity;\nvarying vec4 v_texcoord;\nvarying float v_scale;\nvarying float v_texture_normal;\n\nvarying float v_linesofar;\n// varying float v_ruler;\n\nvoid main() {\n    int tex_idx = int(mod(a_style, 10000.0));\n    float s = floor(a_style / 10000.0);\n    v_opacity = mod(s, 10.0) / 10.0;\n    if (v_opacity == 0.0) {\n        v_opacity = 1.0;\n    }\n    v_linewidth = s / 100.0;\n    v_texcoord = vec4(u_styles[tex_idx], u_styles[tex_idx + 1], u_styles[tex_idx + 2], u_styles[tex_idx + 3]);\n\n    v_scale = u_scale;\n\n    // v_linenormal = a_linenormal;\n\n    vec4 pos = a_pos;\n    pos.x += a_normal.x * v_linewidth * u_scale;\n    pos.y += a_normal.y * v_linewidth * u_scale;\n\n    // add linesofar with corner length caused by line-join\n    v_linesofar = a_linesofar;\n\n\n    gl_Position = u_matrix * pos;\n    if (a_normal.y == 0.0) {\n        // with an upside down straight line, a_normal.y is always 0, use a_normal.x instead\n        v_texture_normal = -sign(a_normal.x);\n    } else {\n        //\n        v_texture_normal = sign(a_normal.y);\n    }\n\n}",ne="\nprecision mediump float;\nuniform sampler2D u_sampler;\nvarying vec3 v_texCoord;\nvoid main() {\n    gl_FragColor = texture2D(u_sampler, vec2(v_texCoord[0] + gl_PointCoord[0] * v_texCoord[1], 1.0 + gl_PointCoord[1] * v_texCoord[2]));\n}",ae="\n// marker's 2d point at max zoom\nattribute vec4 a_pos;\n// texture idx in u_sprite\nattribute float a_sprite_idx;\nuniform mat4 u_matrix;\n// scale of current zoom\nuniform float u_scale;\n// sprites, an array of sprites\n// a sprite has 6 integers:\n// 0 : northwest's x, 1 : width, 2: height, 3: sprite size, 4: offset x, 5: offset y\n// array's length is not dynamic, support maximum count / 6 sprites\nuniform float u_sprite["+ee+"];\nvarying vec3 v_texCoord;\nvoid main() {\n  int idx = int(a_sprite_idx);\n  float size = u_sprite[idx + 3];\n  vec2 textOffset = vec2(u_sprite[idx + 4], u_sprite[idx + 5]);\n  vec4 pos = vec4(a_pos.x + textOffset.x * u_scale, a_pos.y + textOffset.y * u_scale, a_pos.z, a_pos.w);\n  gl_Position = u_matrix * pos;\n  gl_PointSize = size;\n  // texture coord\n  v_texCoord = vec3(u_sprite[idx], u_sprite[idx + 1], u_sprite[idx + 2]);\n}",ie="\nprecision mediump float;\n\nvarying vec4 v_texcoord;\nvarying float v_opacity;\nvoid main() {\n    gl_FragColor = v_texcoord * v_opacity;\n}",oe="attribute vec4 a_pos;\n//tex_idx * 100 + opacity * 10\nattribute float a_fill_style;\n\nuniform mat4 u_matrix;\nuniform float u_fill_styles["+ee+"];\n\nvarying float v_opacity;\nvarying vec4 v_texcoord;\n\nvoid main() {\n  int tex_idx = int(floor(a_fill_style / 100.0));\n  v_opacity = mod(a_fill_style, 100.0) / 10.0;\n  v_texcoord = vec4(u_fill_styles[tex_idx], u_fill_styles[tex_idx + 1], u_fill_styles[tex_idx + 2], u_fill_styles[tex_idx + 3]);\n\n  gl_Position = u_matrix * a_pos;\n}",se="\nprecision mediump float;\n\nvarying vec4 v_texcoord;\nvarying float v_opacity;\n// varying vec4 v_lighting;\n\nvoid main() {\n    gl_FragColor = v_texcoord * v_opacity;\n}",le="attribute vec4 a_pos;\nattribute vec4 a_normal;\n//tex_idx * 100 + opacity * 10\nattribute float a_fill_style;\n\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\nuniform vec3 u_ambientlight;\n\nuniform mat4 u_matrix;\nuniform float u_fill_styles["+ee+"];\n\nvarying float v_opacity;\nvarying vec4 v_texcoord;\n\nvarying vec4 v_lighting;\n\nvoid main() {\n  int tex_idx = int(floor(a_fill_style / 100.0));\n  v_opacity = mod(a_fill_style, 100.0) / 10.0;\n\n  vec4 color = vec4(u_fill_styles[tex_idx], u_fill_styles[tex_idx + 1], u_fill_styles[tex_idx + 2], u_fill_styles[tex_idx + 3]);\n\n  gl_Position = u_matrix * a_pos;\n\n  vec3 normal = normalize(a_normal.xyz);\n  // vec3 lightpos = normalize(u_lightpos);\n  float nDotL = max(dot(u_lightpos, normal), 0.0);\n  vec3 diffuse = u_lightcolor * color.rgb * nDotL;\n\n  vec3 ambient = u_ambientlight * color.rgb;\n\n  v_texcoord = vec4(diffuse + ambient, color.a);\n\n  // vec3 normal = normalize(a_normal.xyz);\n  // vec3 lightpos = normalize(u_lightpos.xyz);\n  // // codes from mapbox-gl-js\n  // v_lighting = vec4(0.0, 0.0, 0.0, 1.0);\n  // float directional = clamp(dot(normal, lightpos), 0.0, 1.0);\n  // directional = mix((1.0 - u_lightintensity), max((0.5 + u_lightintensity), 1.0), directional);\n\n  // // if (a_normal.y != 0.0) {\n  // //   directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n  // // }\n\n  // v_lighting.rgb += clamp(directional * u_lightcolor, mix(vec3(0.0), vec3(0.3), 1.0 - u_lightcolor), vec3(1.0));\n}",ue={line:{fragmentSource:te,vertexSource:re},point:{fragmentSource:ne,vertexSource:ae},polygon:{fragmentSource:ie,vertexSource:oe},extrude:{fragmentSource:se,vertexSource:le}},he=Object.freeze({WebglRenderer:Wt,Shader:ue,Painter:jt,LineAtlas:Gt,LinePainter:Ht,PolygonPainter:$t}),fe={renderer:"webgl",doublBuffer:!1,renderOnMoving:!1,renderOnZooming:!1},ce=function(t){function r(n,a,i){Yt(this,r);var o=e.Util.extend({},i),s=void 0;o.style&&(s=o.style,delete o.style);var l=Vt(this,t.call(this,n,o));return l.data=a,s&&l.setStyle(s),l}return qt(r,t),r.fromJSON=function(t){if(!t||t.type!==this.getJSONType())return null;var e=this.prototype.constructor,r=new e(t.id,t.data,t.options);return t.style&&r.setStyle(t.style),r},r.prototype.toJSON=function(){var t={type:this.getJSONType(),data:this.data,id:this.getId()},e=this.config(),r=this.getStyle();return e&&(t.options=e),r&&(t.style=r),t},r.prototype.setStyle=function(t){return Array.isArray(t)||(t=[t]),this._style=t,this._cookedStyles=e.MapboxUtil.compileStyle(t),this.fire("setstyle",{style:t}),this},r.prototype.getStyle=function(){return this._style},r}(e.Layer);ce.mergeOptions(fe);var ve=B,pe=O,de=U,xe=ve,ye=pe,Me=de,ge=q;V.prototype={range:function(t,e,r,n){return ye(this.ids,this.coords,t,e,r,n,this.nodeSize)},within:function(t,e,r){return Me(this.ids,this.coords,t,e,r,this.nodeSize)}};var me=function(t){function e(){return Yt(this,e),Vt(this,t.apply(this,arguments))}return qt(e,t),e.prototype.identify=function(t,e){var r=this._getRenderer();return r?r.identify(t,e):null},e}(ce);me.registerJSONType("BigPointLayer"),me.registerRenderer("webgl",function(t){function r(e){Yt(this,r);var n=Vt(this,t.call(this,e));return n._needCheckStyle=!0,n._needCheckSprites=!0,n._registerEvents(),n}return qt(r,t),r.prototype.checkResources=function(){if(!this._needCheckStyle)return[];var t=[];return this.layer.getStyle()&&this.layer.getStyle().forEach(function(r){var n=e.Util.getExternalResources(r.symbol,!0);n&&t.push(n)}),this._needCheckStyle=!1,this._needCheckSprites=!0,this._textureLoaded=!1,t},r.prototype.onCanvasCreate=function(){var t=this.gl,e=["u_matrix","u_scale","u_sprite[0]"],r=this.createProgram(ue.point.vertexSource,ue.point.fragmentSource,e);this.useProgram(r);var n=this.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),this.enableVertexAttrib([["a_pos",2],["a_sprite_idx",1]])},r.prototype.draw=function(){if(console.time("draw points"),this.prepareCanvas(),this._checkSprites(),!this._vertexCount){var t=this.getMap(),r=a(t),n=this.layer.data,i=[],o=[];this._vertexCount=0;for(var s=this.gl,l=[0,0],u=0,h=n.length;u<h;u++)if(n[u]){var f=void 0;if(Array.isArray(n[u]))f=n[u];else if(n[u].type){var c=this._getVertice(n[u]);f=[c[0],c[1],n[u].properties]}var v=this._getTexCoord({properties:f[2]});if(v){this._vertexCount++;var p=t.coordinateToPoint(new e.Coordinate(f),r);i.push(p.x,p.y,v.idx),o.push([p.x,p.y,v.size,v.offset,f]),v.size[0]>l[0]&&(l[0]=v.size[0]),v.size[1]>l[1]&&(l[1]=v.size[1])}}s.bufferData(s.ARRAY_BUFFER,new Float32Array(i),s.STATIC_DRAW),this._maxIconSize=l,this._indexData(o)}this._drawMarkers(),console.timeEnd("draw points"),this.completeRender()},r.prototype.onRemove=function(){this._removeEvents(),delete this._sprites,delete this._uSprite,t.prototype.onRemove.apply(this,arguments)},r.prototype.identify=function(t,e){if(!this._kdIndex)return null;var r=this.getMap(),n=r.coordinateToPoint(t,r.getMaxNativeZoom()),a=r.getScale(),i=a*this._maxIconSize[0],o=a*this._maxIconSize[1],s=this._kdIndex.range(n.x-i,n.y-o,n.x+i,n.y+o),l=void 0,u=void 0;e&&(e.filter&&(l=e.filter),e.count&&(u=e.count));for(var h=[],f=0,c=s.length;f<c;f++){var v=this._indexPoints[s[f]],p=v[0],d=v[1],x=v[2],y=v[3],M=[a*(-x[0]/2+y.x),a*(-x[1]/2+y.y),a*(x[0]/2+y.x),a*(x[1]/2+y.y)];if(n.x>=p+M[0]&&n.x<=p+M[2]&&n.y>=d+M[1]&&n.y<=d+M[3]&&(l&&!l(v[4])||h.push(v[4]),u&&h.length>=u))break}return h},r.prototype._indexData=function(t){this._indexPoints=t,this._kdIndex=ge(t,null,null,64,Int32Array)},r.prototype._getTexCoord=function(t){if(!this.layer._cookedStyles)return null;for(var e=0,r=this.layer._cookedStyles.length;e<r;e++)if(this.layer._cookedStyles[e].filter(t)===!0)return{idx:e,texCoord:this._sprites.texCoords[e],offset:this._sprites.offsets[e],size:this._sprites.sizes[e]};return null},r.prototype._checkSprites=function(){var t=this;if(this._needCheckSprites){var r=this.resources,n=[];if(this.layer.getStyle()&&!function(){var a=t.getMap();t.layer.getStyle().forEach(function(t){var i=new e.Marker([0,0],{symbol:t.symbol}),o=i._getSprite(r,a.CanvasClass);o&&n.push(o)})}(),this._sprites=this.mergeSprites(n,!0),this._sprites&&("undefined"!=typeof window&&window.MAPTALKS_WEBGL_DEBUG_CANVAS&&window.MAPTALKS_WEBGL_DEBUG_CANVAS.getContext("2d").drawImage(this._sprites.canvas,0,0),this._needCheckSprites=!1,!this._textureLoaded)){var a=this._sprites.canvas.getContext("2d"),i=this._sprites.canvas.width,o=this._sprites.canvas.height,s=a.getImageData(0,0,i,o);this.loadTexture(s),this.enableSampler("u_sampler"),this._textureLoaded=!0;for(var l=this._uSprite=[],u=0,h=this.layer._cookedStyles.length;u<h;u++)l.push.apply(l,this._sprites.texCoords[u]),l.push(this._sprites.offsets[u].x,this._sprites.offsets[u].y)}}},r.prototype._getVertice=function(t){return t.geometry?t=t.geometry.coordinates:t.coordinates&&(t=t.coordinates),t},r.prototype._drawMarkers=function(){var t=this.gl,e=this.calcMatrices();t.uniformMatrix4fv(t.program.u_matrix,!1,e),t.uniform1f(t.program.u_scale,this.getMap().getScale()),t.uniform1fv(t.program.u_sprite,this._uSprite),t.drawArrays(t.POINTS,0,this._vertexCount)},r.prototype._registerEvents=function(){this.layer.on("setstyle",this._onStyleChanged,this)},r.prototype._removeEvents=function(){this.layer.off("setstyle",this._onStyleChanged,this)},r.prototype._onStyleChanged=function(){this._needCheckStyle=!0},r}(Wt));var _e=r(function(t){var e=function(){function t(e,r,n,a){function o(e,n){if(null===e)return null;if(0==n)return e;var s,f;if("object"!=("undefined"==typeof e?"undefined":Ut(e)))return e;if(t.__isArray(e))s=[];else if(t.__isRegExp(e))s=new RegExp(e.source,i(e)),e.lastIndex&&(s.lastIndex=e.lastIndex);else if(t.__isDate(e))s=new Date(e.getTime());else{if(h&&Buffer.isBuffer(e))return s=new Buffer(e.length),e.copy(s),s;"undefined"==typeof a?(f=Object.getPrototypeOf(e),s=Object.create(f)):(s=Object.create(a),f=a)}if(r){var c=l.indexOf(e);if(c!=-1)return u[c];l.push(e),u.push(s)}for(var v in e){var p;f&&(p=Object.getOwnPropertyDescriptor(f,v)),p&&null==p.set||(s[v]=o(e[v],n-1))}return s}var s;"object"===("undefined"==typeof r?"undefined":Ut(r))&&(n=r.depth,a=r.prototype,s=r.filter,r=r.circular);var l=[],u=[],h="undefined"!=typeof Buffer;return"undefined"==typeof r&&(r=!0),"undefined"==typeof n&&(n=1/0),o(e,n)}function e(t){return Object.prototype.toString.call(t)}function r(t){return"object"===("undefined"==typeof t?"undefined":Ut(t))&&"[object Date]"===e(t)}function n(t){return"object"===("undefined"==typeof t?"undefined":Ut(t))&&"[object Array]"===e(t)}function a(t){return"object"===("undefined"==typeof t?"undefined":Ut(t))&&"[object RegExp]"===e(t)}function i(t){var e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),e}return t.clonePrototype=function(t){if(null===t)return null;var e=function(){};return e.prototype=t,new e},t.__objToStr=e,t.__isDate=r,t.__isArray=n,t.__isRegExp=a,t.__getRegExpFlags=i,t}();t.exports&&(t.exports=e)}),Se={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},be=r(function(t){function e(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2)}var r=Se,n={};for(var a in r)r.hasOwnProperty(a)&&(n[r[a]]=a);var i=t.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var o in i)if(i.hasOwnProperty(o)){if(!("channels"in i[o]))throw new Error("missing channels property: "+o);if(!("labels"in i[o]))throw new Error("missing channel labels property: "+o);if(i[o].labels.length!==i[o].channels)throw new Error("channel and label counts mismatch: "+o);var s=i[o].channels,l=i[o].labels;delete i[o].channels,delete i[o].labels,Object.defineProperty(i[o],"channels",{value:s}),Object.defineProperty(i[o],"labels",{value:l})}i.rgb.hsl=function(t){var e,r,n,a=t[0]/255,i=t[1]/255,o=t[2]/255,s=Math.min(a,i,o),l=Math.max(a,i,o),u=l-s;return l===s?e=0:a===l?e=(i-o)/u:i===l?e=2+(o-a)/u:o===l&&(e=4+(a-i)/u),e=Math.min(60*e,360),e<0&&(e+=360),n=(s+l)/2,r=l===s?0:n<=.5?u/(l+s):u/(2-l-s),[e,100*r,100*n]},i.rgb.hsv=function(t){var e,r,n,a=t[0],i=t[1],o=t[2],s=Math.min(a,i,o),l=Math.max(a,i,o),u=l-s;return r=0===l?0:u/l*1e3/10,l===s?e=0:a===l?e=(i-o)/u:i===l?e=2+(o-a)/u:o===l&&(e=4+(a-i)/u),e=Math.min(60*e,360),e<0&&(e+=360),n=l/255*1e3/10,[e,r,n]},i.rgb.hwb=function(t){var e=t[0],r=t[1],n=t[2],a=i.rgb.hsl(t)[0],o=1/255*Math.min(e,Math.min(r,n));return n=1-1/255*Math.max(e,Math.max(r,n)),[a,100*o,100*n]},i.rgb.cmyk=function(t){var e,r,n,a,i=t[0]/255,o=t[1]/255,s=t[2]/255;return a=Math.min(1-i,1-o,1-s),e=(1-i-a)/(1-a)||0,r=(1-o-a)/(1-a)||0,n=(1-s-a)/(1-a)||0,[100*e,100*r,100*n,100*a]},i.rgb.keyword=function(t){var a=n[t];if(a)return a;var i,o=1/0;for(var s in r)if(r.hasOwnProperty(s)){var l=r[s],u=e(t,l);u<o&&(o=u,i=s)}return i},i.keyword.rgb=function(t){return r[t]},i.rgb.xyz=function(t){var e=t[0]/255,r=t[1]/255,n=t[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92;var a=.4124*e+.3576*r+.1805*n,i=.2126*e+.7152*r+.0722*n,o=.0193*e+.1192*r+.9505*n;return[100*a,100*i,100*o]},i.rgb.lab=function(t){var e,r,n,a=i.rgb.xyz(t),o=a[0],s=a[1],l=a[2];return o/=95.047,s/=100,l/=108.883,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,l=l>.008856?Math.pow(l,1/3):7.787*l+16/116,e=116*s-16,r=500*(o-s),n=200*(s-l),[e,r,n]},i.hsl.rgb=function(t){var e,r,n,a,i,o=t[0]/360,s=t[1]/100,l=t[2]/100;if(0===s)return i=255*l,[i,i,i];r=l<.5?l*(1+s):l+s-l*s,e=2*l-r,a=[0,0,0];for(var u=0;u<3;u++)n=o+1/3*-(u-1),n<0&&n++,n>1&&n--,i=6*n<1?e+6*(r-e)*n:2*n<1?r:3*n<2?e+(r-e)*(2/3-n)*6:e,a[u]=255*i;return a},i.hsl.hsv=function(t){var e,r,n=t[0],a=t[1]/100,i=t[2]/100,o=a,s=Math.max(i,.01);return i*=2,a*=i<=1?i:2-i,o*=s<=1?s:2-s,r=(i+a)/2,e=0===i?2*o/(s+o):2*a/(i+a),[n,100*e,100*r]},i.hsv.rgb=function(t){var e=t[0]/60,r=t[1]/100,n=t[2]/100,a=Math.floor(e)%6,i=e-Math.floor(e),o=255*n*(1-r),s=255*n*(1-r*i),l=255*n*(1-r*(1-i));switch(n*=255,a){case 0:return[n,l,o];case 1:return[s,n,o];case 2:return[o,n,l];case 3:return[o,s,n];case 4:return[l,o,n];case 5:return[n,o,s]}},i.hsv.hsl=function(t){var e,r,n,a=t[0],i=t[1]/100,o=t[2]/100,s=Math.max(o,.01);return n=(2-i)*o,e=(2-i)*s,r=i*s,r/=e<=1?e:2-e,r=r||0,n/=2,[a,100*r,100*n]},i.hwb.rgb=function(t){var e,r,n,a,i=t[0]/360,o=t[1]/100,s=t[2]/100,l=o+s;l>1&&(o/=l,s/=l),e=Math.floor(6*i),r=1-s,n=6*i-e,0!==(1&e)&&(n=1-n),a=o+n*(r-o);var u,h,f;switch(e){default:case 6:case 0:u=r,h=a,f=o;break;case 1:u=a,h=r,f=o;break;case 2:u=o,h=r,f=a;break;case 3:u=o,h=a,f=r;break;case 4:u=a,h=o,f=r;break;case 5:u=r,h=o,f=a}return[255*u,255*h,255*f]},i.cmyk.rgb=function(t){var e,r,n,a=t[0]/100,i=t[1]/100,o=t[2]/100,s=t[3]/100;return e=1-Math.min(1,a*(1-s)+s),r=1-Math.min(1,i*(1-s)+s),n=1-Math.min(1,o*(1-s)+s),[255*e,255*r,255*n]},i.xyz.rgb=function(t){var e,r,n,a=t[0]/100,i=t[1]/100,o=t[2]/100;return e=3.2406*a+i*-1.5372+o*-.4986,
r=a*-.9689+1.8758*i+.0415*o,n=.0557*a+i*-.204+1.057*o,e=e>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,e=Math.min(Math.max(0,e),1),r=Math.min(Math.max(0,r),1),n=Math.min(Math.max(0,n),1),[255*e,255*r,255*n]},i.xyz.lab=function(t){var e,r,n,a=t[0],i=t[1],o=t[2];return a/=95.047,i/=100,o/=108.883,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,e=116*i-16,r=500*(a-i),n=200*(i-o),[e,r,n]},i.lab.xyz=function(t){var e,r,n,a=t[0],i=t[1],o=t[2];r=(a+16)/116,e=i/500+r,n=r-o/200;var s=Math.pow(r,3),l=Math.pow(e,3),u=Math.pow(n,3);return r=s>.008856?s:(r-16/116)/7.787,e=l>.008856?l:(e-16/116)/7.787,n=u>.008856?u:(n-16/116)/7.787,e*=95.047,r*=100,n*=108.883,[e,r,n]},i.lab.lch=function(t){var e,r,n,a=t[0],i=t[1],o=t[2];return e=Math.atan2(o,i),r=360*e/2/Math.PI,r<0&&(r+=360),n=Math.sqrt(i*i+o*o),[a,n,r]},i.lch.lab=function(t){var e,r,n,a=t[0],i=t[1],o=t[2];return n=o/360*2*Math.PI,e=i*Math.cos(n),r=i*Math.sin(n),[a,e,r]},i.rgb.ansi16=function(t){var e=t[0],r=t[1],n=t[2],a=1 in arguments?arguments[1]:i.rgb.hsv(t)[2];if(a=Math.round(a/50),0===a)return 30;var o=30+(Math.round(n/255)<<2|Math.round(r/255)<<1|Math.round(e/255));return 2===a&&(o+=60),o},i.hsv.ansi16=function(t){return i.rgb.ansi16(i.hsv.rgb(t),t[2])},i.rgb.ansi256=function(t){var e=t[0],r=t[1],n=t[2];if(e===r&&r===n)return e<8?16:e>248?231:Math.round((e-8)/247*24)+232;var a=16+36*Math.round(e/255*5)+6*Math.round(r/255*5)+Math.round(n/255*5);return a},i.ansi16.rgb=function(t){var e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),e=e/10.5*255,[e,e,e];var r=.5*(~~(t>50)+1),n=(1&e)*r*255,a=(e>>1&1)*r*255,i=(e>>2&1)*r*255;return[n,a,i]},i.ansi256.rgb=function(t){if(t>=232){var e=10*(t-232)+8;return[e,e,e]}t-=16;var r,n=Math.floor(t/36)/5*255,a=Math.floor((r=t%36)/6)/5*255,i=r%6/5*255;return[n,a,i]},i.rgb.hex=function(t){var e=((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2])),r=e.toString(16).toUpperCase();return"000000".substring(r.length)+r},i.hex.rgb=function(t){var e=t.toString(16).match(/[a-f0-9]{6}/i);if(!e)return[0,0,0];var r=parseInt(e[0],16),n=r>>16&255,a=r>>8&255,i=255&r;return[n,a,i]},i.rgb.hcg=function(t){var e,r,n=t[0]/255,a=t[1]/255,i=t[2]/255,o=Math.max(Math.max(n,a),i),s=Math.min(Math.min(n,a),i),l=o-s;return e=l<1?s/(1-l):0,r=l<=0?0:o===n?(a-i)/l%6:o===a?2+(i-n)/l:4+(n-a)/l+4,r/=6,r%=1,[360*r,100*l,100*e]},i.hsl.hcg=function(t){var e=t[1]/100,r=t[2]/100,n=1,a=0;return n=r<.5?2*e*r:2*e*(1-r),n<1&&(a=(r-.5*n)/(1-n)),[t[0],100*n,100*a]},i.hsv.hcg=function(t){var e=t[1]/100,r=t[2]/100,n=e*r,a=0;return n<1&&(a=(r-n)/(1-n)),[t[0],100*n,100*a]},i.hcg.rgb=function(t){var e=t[0]/360,r=t[1]/100,n=t[2]/100;if(0===r)return[255*n,255*n,255*n];var a=[0,0,0],i=e%1*6,o=i%1,s=1-o,l=0;switch(Math.floor(i)){case 0:a[0]=1,a[1]=o,a[2]=0;break;case 1:a[0]=s,a[1]=1,a[2]=0;break;case 2:a[0]=0,a[1]=1,a[2]=o;break;case 3:a[0]=0,a[1]=s,a[2]=1;break;case 4:a[0]=o,a[1]=0,a[2]=1;break;default:a[0]=1,a[1]=0,a[2]=s}return l=(1-r)*n,[255*(r*a[0]+l),255*(r*a[1]+l),255*(r*a[2]+l)]},i.hcg.hsv=function(t){var e=t[1]/100,r=t[2]/100,n=e+r*(1-e),a=0;return n>0&&(a=e/n),[t[0],100*a,100*n]},i.hcg.hsl=function(t){var e=t[1]/100,r=t[2]/100,n=r*(1-e)+.5*e,a=0;return n>0&&n<.5?a=e/(2*n):n>=.5&&n<1&&(a=e/(2*(1-n))),[t[0],100*a,100*n]},i.hcg.hwb=function(t){var e=t[1]/100,r=t[2]/100,n=e+r*(1-e);return[t[0],100*(n-e),100*(1-n)]},i.hwb.hcg=function(t){var e=t[1]/100,r=t[2]/100,n=1-r,a=n-e,i=0;return a<1&&(i=(n-a)/(1-a)),[t[0],100*a,100*i]},i.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},i.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},i.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},i.gray.hsl=i.gray.hsv=function(t){return[0,0,t[0]]},i.gray.hwb=function(t){return[0,100,t[0]]},i.gray.cmyk=function(t){return[0,0,0,t[0]]},i.gray.lab=function(t){return[t[0],0,0]},i.gray.hex=function(t){var e=255&Math.round(t[0]/100*255),r=(e<<16)+(e<<8)+e,n=r.toString(16).toUpperCase();return"000000".substring(n.length)+n},i.rgb.gray=function(t){var e=(t[0]+t[1]+t[2])/3;return[e/255*100]}}),Ie=be,Fe=Object.keys(Ie),De=function(t){for(var e=G(t),r={},n=Object.keys(e),a=n.length,i=0;i<a;i++){var o=n[i],s=e[o];null!==s.parent&&(r[o]=J(o,e))}return r},Ae=be,we=De,Ee={},Re=Object.keys(Ae);Re.forEach(function(t){Ee[t]={},Object.defineProperty(Ee[t],"channels",{value:Ae[t].channels}),Object.defineProperty(Ee[t],"labels",{value:Ae[t].labels});var e=we(t),r=Object.keys(e);r.forEach(function(r){var n=e[r];Ee[t][r]=K(n),Ee[t][r].raw=H(n)})});var Pe=Ee,ze=Se,Ce={getRgba:Q,getHsla:$,getRgb:et,getHsl:rt,getHwb:tt,getAlpha:nt,hexString:at,rgbString:it,rgbaString:ot,percentString:st,percentaString:lt,hslString:ut,hslaString:ht,hwbString:ft,keyword:ct},Te={};for(var Be in ze)Te[ze[Be]]=Be;var Le=_e,ke=Pe,Ne=Ce,Oe=function t(e){if(e instanceof t)return e;if(!(this instanceof t))return new t(e);this.values={rgb:[0,0,0],hsl:[0,0,0],hsv:[0,0,0],hwb:[0,0,0],cmyk:[0,0,0,0],alpha:1};var r;if("string"==typeof e)if(r=Ne.getRgba(e))this.setValues("rgb",r);else if(r=Ne.getHsla(e))this.setValues("hsl",r);else{if(!(r=Ne.getHwb(e)))throw new Error('Unable to parse color from string "'+e+'"');this.setValues("hwb",r)}else if("object"===("undefined"==typeof e?"undefined":Ut(e)))if(r=e,void 0!==r.r||void 0!==r.red)this.setValues("rgb",r);else if(void 0!==r.l||void 0!==r.lightness)this.setValues("hsl",r);else if(void 0!==r.v||void 0!==r.value)this.setValues("hsv",r);else if(void 0!==r.w||void 0!==r.whiteness)this.setValues("hwb",r);else{if(void 0===r.c&&void 0===r.cyan)throw new Error("Unable to parse color from object "+JSON.stringify(e));this.setValues("cmyk",r)}};Oe.prototype={rgb:function(){return this.setSpace("rgb",arguments)},hsl:function(){return this.setSpace("hsl",arguments)},hsv:function(){return this.setSpace("hsv",arguments)},hwb:function(){return this.setSpace("hwb",arguments)},cmyk:function(){return this.setSpace("cmyk",arguments)},rgbArray:function(){return this.values.rgb},hslArray:function(){return this.values.hsl},hsvArray:function(){return this.values.hsv},hwbArray:function(){return 1!==this.values.alpha?this.values.hwb.concat([this.values.alpha]):this.values.hwb},cmykArray:function(){return this.values.cmyk},rgbaArray:function(){var t=this.values.rgb;return t.concat([this.values.alpha])},rgbaArrayNormalized:function(){for(var t=this.values.rgb,e=[],r=0;r<3;r++)e[r]=t[r]/255;return e.push(this.values.alpha),e},hslaArray:function(){var t=this.values.hsl;return t.concat([this.values.alpha])},alpha:function(t){return void 0===t?this.values.alpha:(this.setValues("alpha",t),this)},red:function(t){return this.setChannel("rgb",0,t)},green:function(t){return this.setChannel("rgb",1,t)},blue:function(t){return this.setChannel("rgb",2,t)},hue:function(t){return t&&(t%=360,t=t<0?360+t:t),this.setChannel("hsl",0,t)},saturation:function(t){return this.setChannel("hsl",1,t)},lightness:function(t){return this.setChannel("hsl",2,t)},saturationv:function(t){return this.setChannel("hsv",1,t)},whiteness:function(t){return this.setChannel("hwb",1,t)},blackness:function(t){return this.setChannel("hwb",2,t)},value:function(t){return this.setChannel("hsv",2,t)},cyan:function(t){return this.setChannel("cmyk",0,t)},magenta:function(t){return this.setChannel("cmyk",1,t)},yellow:function(t){return this.setChannel("cmyk",2,t)},black:function(t){return this.setChannel("cmyk",3,t)},hexString:function(){return Ne.hexString(this.values.rgb)},rgbString:function(){return Ne.rgbString(this.values.rgb,this.values.alpha)},rgbaString:function(){return Ne.rgbaString(this.values.rgb,this.values.alpha)},percentString:function(){return Ne.percentString(this.values.rgb,this.values.alpha)},hslString:function(){return Ne.hslString(this.values.hsl,this.values.alpha)},hslaString:function(){return Ne.hslaString(this.values.hsl,this.values.alpha)},hwbString:function(){return Ne.hwbString(this.values.hwb,this.values.alpha)},keyword:function(){return Ne.keyword(this.values.rgb,this.values.alpha)},rgbNumber:function(){return this.values.rgb[0]<<16|this.values.rgb[1]<<8|this.values.rgb[2]},luminosity:function(){for(var t=this.values.rgb,e=[],r=0;r<t.length;r++){var n=t[r]/255;e[r]=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity(),r=t.luminosity();return e>r?(e+.05)/(r+.05):(r+.05)/(e+.05)},level:function(t){var e=this.contrast(t);return e>=7.1?"AAA":e>=4.5?"AA":""},dark:function(){var t=this.values.rgb,e=(299*t[0]+587*t[1]+114*t[2])/1e3;return e<128},light:function(){return!this.dark()},negate:function(){for(var t=[],e=0;e<3;e++)t[e]=255-this.values.rgb[e];return this.setValues("rgb",t),this},lighten:function(t){return this.values.hsl[2]+=this.values.hsl[2]*t,this.setValues("hsl",this.values.hsl),this},darken:function(t){return this.values.hsl[2]-=this.values.hsl[2]*t,this.setValues("hsl",this.values.hsl),this},saturate:function(t){return this.values.hsl[1]+=this.values.hsl[1]*t,this.setValues("hsl",this.values.hsl),this},desaturate:function(t){return this.values.hsl[1]-=this.values.hsl[1]*t,this.setValues("hsl",this.values.hsl),this},whiten:function(t){return this.values.hwb[1]+=this.values.hwb[1]*t,this.setValues("hwb",this.values.hwb),this},blacken:function(t){return this.values.hwb[2]+=this.values.hwb[2]*t,this.setValues("hwb",this.values.hwb),this},greyscale:function(){var t=this.values.rgb,e=.3*t[0]+.59*t[1]+.11*t[2];return this.setValues("rgb",[e,e,e]),this},clearer:function(t){return this.setValues("alpha",this.values.alpha-this.values.alpha*t),this},opaquer:function(t){return this.setValues("alpha",this.values.alpha+this.values.alpha*t),this},rotate:function(t){var e=this.values.hsl[0];return e=(e+t)%360,e=e<0?360+e:e,this.values.hsl[0]=e,this.setValues("hsl",this.values.hsl),this},mix:function(t,e){var r=this,n=t,a=void 0===e?.5:e,i=2*a-1,o=r.alpha()-n.alpha(),s=((i*o===-1?i:(i+o)/(1+i*o))+1)/2,l=1-s;return this.rgb(s*r.red()+l*n.red(),s*r.green()+l*n.green(),s*r.blue()+l*n.blue()).alpha(r.alpha()*a+n.alpha()*(1-a))},toJSON:function(){return this.rgb()},clone:function(){var t=new Oe;return t.values=Le(this.values),t}},Oe.prototype.getValues=function(t){for(var e={},r=0;r<t.length;r++)e[t.charAt(r)]=this.values[t][r];return 1!==this.values.alpha&&(e.a=this.values.alpha),e},Oe.prototype.setValues=function(t,e){var r,n={rgb:["red","green","blue"],hsl:["hue","saturation","lightness"],hsv:["hue","saturation","value"],hwb:["hue","whiteness","blackness"],cmyk:["cyan","magenta","yellow","black"]},a={rgb:[255,255,255],hsl:[360,100,100],hsv:[360,100,100],hwb:[360,100,100],cmyk:[100,100,100,100]},i=1;if("alpha"===t)i=e;else if(e.length)this.values[t]=e.slice(0,t.length),i=e[t.length];else if(void 0!==e[t.charAt(0)]){for(r=0;r<t.length;r++)this.values[t][r]=e[t.charAt(r)];i=e.a}else if(void 0!==e[n[t][0]]){var o=n[t];for(r=0;r<t.length;r++)this.values[t][r]=e[o[r]];i=e.alpha}if(this.values.alpha=Math.max(0,Math.min(1,void 0===i?this.values.alpha:i)),"alpha"===t)return!1;var s;for(r=0;r<t.length;r++)s=Math.max(0,Math.min(a[t][r],this.values[t][r])),this.values[t][r]=Math.round(s);for(var l in n)for(l!==t&&(this.values[l]=ke[t][l](this.values[t])),r=0;r<l.length;r++)s=Math.max(0,Math.min(a[l][r],this.values[l][r])),this.values[l][r]=Math.round(s);return!0},Oe.prototype.setSpace=function(t,e){var r=e[0];return void 0===r?this.getValues(t):("number"==typeof r&&(r=Array.prototype.slice.call(e)),this.setValues(t,r),this)},Oe.prototype.setChannel=function(t,e,r){return void 0===r?this.values[t][e]:r===this.values[t][e]?this:(this.values[t][e]=r,this.setValues(t,this.values[t]),this)};var Ue=Oe,Ye=function(t){function r(e){Yt(this,r);var n=Vt(this,t.call(this,e));return n._needCheckStyle=!0,n._needCheckSprites=!0,n._registerEvents(),n}return qt(r,t),r.prototype.checkResources=function(){if(!this._needCheckStyle)return[];var t=[];return this.layer._cookedStyles&&this.layer._cookedStyles.forEach(function(r){r.symbol=e.Util.convertResourceUrl(r.symbol);var n=e.Util.getExternalResources(r.symbol,!0);n&&t.push(n)}),this._needCheckStyle=!1,this._needCheckSprites=!0,this._textureLoaded=!1,0===t.length?[]:t},r.prototype.onCanvasCreate=function(){this.gl.getExtension("OES_element_index_uint")},r.prototype.onRemove=function(){this._removeEvents(),delete this._fillSprites,delete this._sprites,t.prototype.onRemove.apply(this,arguments)},r.prototype.getDataSymbol=function(t){for(var e=-1,r=0,n=this.layer._cookedStyles.length;r<n;r++){var a=this.layer._cookedStyles[r],i=this.getTexture(a.symbol);if(i&&e++,a.filter(t)===!0)return i?{symbol:a.symbol,texCoord:this._fillSprites.texCoords[e],index:r}:{symbol:a.symbol,index:r}}return null},r.prototype.getLineTexture=function(t){return this._atlas.getAtlas(t)},r.prototype.getFillTexture=function(t){var e=t?t.polygonPatternFile:null;return e?this.resources.getImage(e):null},r.prototype._checkSprites=function(){var t=this;if(this._needCheckSprites){this._atlas=new Gt(this.resources);var r=[],n=[];if(this.layer._cookedStyles&&this.layer._cookedStyles.forEach(function(a){var i=t.getLineTexture(a.symbol);i&&r.push(i),i=t.getFillTexture(a.symbol),i&&n.push({canvas:i,offset:new e.Point(0,0)})}),this._sprites=this.mergeSprites(r),this._fillSprites=this.mergeSprites(n),this._sprites&&"undefined"!=typeof window&&window.MAPTALKS_WEBGL_DEBUG_CANVAS){var a=window.MAPTALKS_WEBGL_DEBUG_CANVAS;a.getContext("2d").fillRect(0,0,a.width,a.height),a.getContext("2d").fillStyle="rgb(255, 255, 255)",a.getContext("2d").fillRect(0,0,this._sprites.canvas.width,this._sprites.canvas.height),a.getContext("2d").drawImage(this._sprites.canvas,0,0)}this._needCheckSprites=!1,this._sprites&&!this._textureLoaded&&(this.loadTexture(this._sprites.canvas),this.enableSampler("u_image"),this._textureLoaded=!0),this._fillSprites&&!this._fillTextureLoaded&&(this.loadTexture(this._fillSprites.canvas),this.enableSampler("u_fill_image"),this._fillTextureLoaded=!0);for(var i=0,o=this._uStyle=[],s=0,l=this.layer._cookedStyles.length;s<l;s++){var u=this.layer._cookedStyles[s],h=this.getLineTexture(u.symbol);if(h)o.push.apply(o,this._sprites.texCoords[i++]),o.push(-1);else{var f=u.symbol.lineColor||"#000000";f=Ue(f).rgbaArrayNormalized(),o.push.apply(o,f)}}i=0;for(var c=this._uFillStyle=[],v=0,p=this.layer._cookedStyles.length;v<p;v++){var d=this.layer._cookedStyles[v],x=this.getFillTexture(d.symbol);if(x)c.push.apply(c,this._fillSprites.texCoords[i++]),c.push(-1);else{var y=d.symbol.polygonFill||"#ffffff";y=Ue(y).rgbaArrayNormalized(),c.push.apply(c,y)}}}},r.prototype._registerEvents=function(){this.layer.on("setstyle",this._onStyleChanged,this)},r.prototype._removeEvents=function(){this.layer.off("setstyle",this._onStyleChanged,this)},r.prototype._onStyleChanged=function(){this._needCheckStyle=!0},r}(Wt),qe={blur:2},Ve=function(t){function e(){return Yt(this,e),Vt(this,t.apply(this,arguments))}return qt(e,t),e}(ce);Ve.mergeOptions(qe),Ve.registerJSONType("BigLineLayer");var je=function(t){function e(){return Yt(this,e),Vt(this,t.apply(this,arguments))}return qt(e,t),e.prototype.onCanvasCreate=function(){var e=["u_matrix","u_scale","u_tex_size","u_styles[0]"];this._lineProgram=this.createProgram(ue.line.vertexSource,ue.line.fragmentSource,e),t.prototype.onCanvasCreate.call(this)},e.prototype.draw=function(){console.time("draw lines"),this.prepareCanvas(),this._drawLines(),console.timeEnd("draw lines"),this.completeRender()},e.prototype.onRemove=function(){delete this._lineArrays,t.prototype.onRemove.apply(this,arguments)},e.prototype.getTexture=function(t){return this.getLineTexture(t)},e.prototype._drawLines=function(){var t=this.gl,e=this.getMap(),r=this._lineProgram;this.useProgram(r),this._checkSprites(),this._prepareLineData(),this._bufferLineData(this._lineArrays);var n=this.calcMatrices();t.uniformMatrix4fv(t.program.u_matrix,!1,n),t.uniform1f(r.u_scale,e.getScale()/e.getScale(a(e))),t.uniform1fv(r.u_styles,this._uStyle);var i=[0,0];this._sprites&&(i=[this._sprites.canvas.width,this._sprites.canvas.height]),t.uniform2fv(r.u_tex_size,new Float32Array(i)),t.drawElements(t.TRIANGLES,this._elementCount,t.UNSIGNED_INT,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)},e.prototype._prepareLineData=function(){if(!this._lineArrays){for(var t=this.gl,e=this.getMap(),r=this.layer.data,n=new Ht(t,e),a=void 0,i=0,o=r.length;i<o;i++)r[i]&&(Array.isArray(r[i])?(a=this.getDataSymbol(r[i][1]),n.addLine(r[i][0],a)):r[i].type&&(a=this.getDataSymbol(r[i].properties),n.addLine(r[i],a)));var s=this._lineArrays=n.getArrays();this._elementCount=s.elementArray.length}},e.prototype._bufferLineData=function(t){var e=this.gl;if(this._vertexBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer);else{var r=this._vertexBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.vertexArray),e.STATIC_DRAW)}if(this.enableVertexAttrib(["a_pos",2,"FLOAT"]),this._normalBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._normalBuffer);else{var n=this._normalBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.normalArray),e.STATIC_DRAW)}if(this.enableVertexAttrib([["a_normal",2,"FLOAT"],["a_linesofar",1,"FLOAT"]]),this._texBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._texBuffer);else{var a=this._texBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.styleArray),e.STATIC_DRAW)}if(this.enableVertexAttrib([["a_style",1,"FLOAT"]]),e.bindBuffer(e.ARRAY_BUFFER,null),this._elementBuffer)e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._elementBuffer);else{var i=this._elementBuffer=this.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint32Array(t.elementArray),e.STATIC_DRAW)}},e}(Ye);Ve.registerRenderer("webgl",je);var Ze={blur:2},We=function(t){function e(){return Yt(this,e),Vt(this,t.apply(this,arguments))}return qt(e,t),e}(ce);We.mergeOptions(Ze),We.registerJSONType("BigPolygonLayer"),We.registerRenderer("webgl",function(t){function e(){return Yt(this,e),Vt(this,t.apply(this,arguments))}return qt(e,t),e.prototype.onCanvasCreate=function(){var e=["u_matrix","u_fill_styles[0]"];this._polygonProgram=this.createProgram(ue.polygon.vertexSource,ue.polygon.fragmentSource,e),t.prototype.onCanvasCreate.call(this)},e.prototype.draw=function(){console.time("draw polygons"),this.prepareCanvas(),this._drawPolygons(),this.gl.disable(this.gl.BLEND),this._drawLines(),this.gl.enable(this.gl.BLEND),console.timeEnd("draw polygons"),this.completeRender()},e.prototype.getTexture=function(t){return this.getFillTexture(t)},e.prototype._drawPolygons=function(){var t=this.gl,e=this._polygonProgram;this.useProgram(e),this._checkSprites(),this._preparePolygonData(),this._bufferPolygonData(this._polygonArrays);var r=this.calcMatrices();t.uniformMatrix4fv(t.program.u_matrix,!1,r),t.uniform1fv(e.u_fill_styles,this._uFillStyle),t.drawElements(t.TRIANGLES,this._polygonElementCount,t.UNSIGNED_INT,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)},e.prototype._preparePolygonData=function(){if(!this._polygonArrays){for(var t=this.gl,e=this.getMap(),r=this.layer.data,n=new $t(t,e),a=void 0,i=0,o=r.length;i<o;i++)r[i]&&(Array.isArray(r[i])?(a=this.getDataSymbol(r[i][1]),n.addPolygon(r[i][0],a)):r[i].type&&(a=this.getDataSymbol(r[i].properties),n.addPolygon(r[i],a)));var s=this._polygonArrays=n.getArrays();this._polygonElementCount=s.elementArray.length}},e.prototype._bufferPolygonData=function(t){var e=this.gl;if(this._polygonVertexBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._polygonVertexBuffer);else{var r=this._polygonVertexBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.vertexArray),e.STATIC_DRAW)}if(this.enableVertexAttrib(["a_pos",2,"FLOAT"]),this._polygonTexBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._polygonTexBuffer);else{var n=this._polygonTexBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.styleArray),e.STATIC_DRAW)}if(this.enableVertexAttrib([["a_fill_style",1,"FLOAT"]]),e.bindBuffer(e.ARRAY_BUFFER,null),this._polygonElemBuffer)e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._polygonElemBuffer);else{var a=this._polygonElemBuffer=this.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint32Array(t.elementArray),e.STATIC_DRAW)}},e.prototype.onRemove=function(){delete this._polygonArrays,t.prototype.onRemove.apply(this,arguments)},e}(je));var Ge={project:!0},Xe=function(t){function r(e,n,a){Yt(this,r);var i=Vt(this,t.call(this,e,n,a));return i.vertexArray=[],i.normalArray=[],i.elementArray=[],i.styleArray=[],i}return qt(r,t),r.prototype.getArrays=function(){return{vertexArray:this.vertexArray,normalArray:this.normalArray,elementArray:this.elementArray,styleArray:this.styleArray}},r.prototype.addPolygon=function(t,e,r){if(!t)return this;if(r.symbol.polygonOpacity<=0)return this;var n=this._getVertice(t);if(n[0]&&Array.isArray(n[0][0])&&Array.isArray(n[0][0][0])){for(var a=0,i=n.length;a<i;a++)this.addPolygon(n[a],r);return this}return this._fillArrays(n,e,r),this},r.prototype._fillArrays=function(t,r,n){for(var i=3,o=a(this.map),s=Kt.flatten(t),l=[],u=[],h=void 0,f=0,c=s.vertices.length;f<c;f+=2)f===c-1&&this._equalCoord(s.vertices[f],s.vertices[0])||(this.options.project?(h=this.map.coordinateToPoint(new e.Coordinate(s.vertices[f],s.vertices[f+1]),o),l.push(h.x,h.y,0),u.push(h.x,h.y,r)):(l.push(s.vertices[f],s.vertices[f+1],0),u.push(s.vertices[f],s.vertices[f+1],r)));s.vertices=l;var v=Kt(s.vertices,s.holes,i);if(!(v.length<=2)){var p=Kt.deviation(s.vertices,s.holes,i,v);if(Math.round(1e3*p)/1e3!==0)return void(console&&console.warn("Failed triangluation."));var d=l.length/i,x=this.vertexArray.length,y=this.vertexArray.length/i;y>0&&(v=v.map(function(t){return t+y})),e.Util.pushIn(this.vertexArray,l),e.Util.pushIn(this.elementArray,v);for(var M=0;M<d;M++)this.normalArray.push(0,0,-1);d>0&&(v=v.map(function(t){return t+d})),e.Util.pushIn(this.vertexArray,u),e.Util.pushIn(this.elementArray,v);for(var g=0;g<d;g++)this.normalArray.push(0,0,1);for(var m=this.vertexArray.length/i,_=0,S=d;_<S-1;_++){var b=_*i,I=new Xt(l[b+3],l[b+4]).sub(new Xt(l[b],l[b+1]))._unit()._perp();this.vertexArray.push(l[b],l[b+1],l[b+2]),this.vertexArray.push(l[b+3],l[b+4],l[b+5]),this.vertexArray.push(u[b+3],u[b+4],u[b+5]),this.vertexArray.push(u[b],u[b+1],u[b+2]);for(var F=0;F<4;F++)this.normalArray.push(I.x,I.y,0);var D=4*_;this.elementArray.push(m+D,m+D+1,m+D+2),this.elementArray.push(m+D,m+D+2,m+D+3)}this._addTexCoords(this.vertexArray.length-x,n)}},r.prototype._getVertice=function(t){return t.geometry?t=t.geometry.coordinates:t.coordinates&&(t=t.coordinates),t},r.prototype._addTexCoords=function(t,e){for(var r=100*e.index+10*(e.symbol.polygonOpacity||1),n=0;n<t;n++)this.styleArray.push(r)},r.prototype._equalCoord=function(t,e){return t[0]===e[0]&&t[1]===e[1]},r}(jt);Xe.mergeOptions(Ge);var Je=function(t){function e(){return Yt(this,e),Vt(this,t.apply(this,arguments))}return qt(e,t),e}(ce);Je.registerJSONType("ExtrudePolygonLayer");var He=function(t){function e(){return Yt(this,e),Vt(this,t.apply(this,arguments))}return qt(e,t),e.prototype.onCanvasCreate=function(){var e=["u_matrix","u_fill_styles[0]","u_lightcolor","u_lightpos","u_ambientlight"];this.program=this.createProgram(ue.extrude.vertexSource,ue.extrude.fragmentSource,e),t.prototype.onCanvasCreate.call(this);var r=this.gl;r.enable(r.DEPTH_TEST),r.disable(r.BLEND),r.disable(r.STENCIL_TEST),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1)},e.prototype.draw=function(){this.prepareCanvas(),this._drawExtrudes(),this.completeRender()},e.prototype.onRemove=function(){delete this._extrudeArrays,t.prototype.onRemove.apply(this,arguments)},e.prototype.getTexture=function(t){return this.getFillTexture(t)},e.prototype._drawExtrudes=function(){var t=this.gl,e=this.program;this.useProgram(e),this._checkSprites(),this._prepareData();var r=this.calcMatrices();t.uniformMatrix4fv(t.program.u_matrix,!1,r),t.uniform1fv(e.u_fill_styles,this._uFillStyle),t.uniform3fv(t.program.u_lightpos,Ot.normalize([],[.5,3,4])),t.uniform3f(t.program.u_lightcolor,1,1,1),t.uniform3f(t.program.u_ambientlight,.2,.2,.2),this._bufferExtrudeData(this._extrudeArrays),t.drawElements(t.TRIANGLES,this._elementCount,t.UNSIGNED_INT,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)},e.prototype._prepareData=function(){if(!this._extrudeArrays){for(var t=this.gl,e=this.getMap(),r=a(e),n=this.layer.data,i=new Xe(t,e),o=0,s=n.length;o<s;o++)if(n[o])if(Array.isArray(n[o])){var l=this.getDataSymbol(n[o][1]),u=n[o][1].height,h=e.distanceToPixel(u,0,r).width;i.addPolygon(n[o][0],h,l)}else if(n[o].type){var f=this.getDataSymbol(n[o].properties),c=n[o].properties.height,v=e.distanceToPixel(c,0,r).width;i.addPolygon(n[o],v,f)}var p=this._extrudeArrays=i.getArrays();this._elementCount=p.elementArray.length}},e.prototype._bufferExtrudeData=function(t){var e=this.gl;if(this._vertexBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer);else{var r=this._vertexBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.vertexArray),e.STATIC_DRAW)}if(this.enableVertexAttrib(["a_pos",3,"FLOAT"]),this._normalBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._normalBuffer);else{var n=this._normalBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.normalArray),e.STATIC_DRAW)}if(this.enableVertexAttrib(["a_normal",3,"FLOAT"]),this._texBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._texBuffer);else{var a=this._texBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.styleArray),e.STATIC_DRAW)}if(this.enableVertexAttrib([["a_fill_style",1,"FLOAT"]]),e.bindBuffer(e.ARRAY_BUFFER,null),this._elementBuffer)e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._elementBuffer);else{var i=this._elementBuffer=this.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint32Array(t.elementArray),e.STATIC_DRAW)}},e}(Ye);Je.registerRenderer("webgl",He),t.webgl=he,t.BigDataLayer=ce,t.BigPointLayer=me,t.BigLineLayer=Ve,t.BigPolygonLayer=We,t.ExtrudePolygonLayer=Je,Object.defineProperty(t,"__esModule",{value:!0})});